{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.0b3", "generated_at": "2026-01-29T20:19:51.768006Z", "invocation_id": "77fbcd34-5be5-4a91-b460-e66294f6406f", "invocation_started_at": "2026-01-29T20:19:40.771459Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.911032Z", "completed_at": "2026-01-29T20:19:48.916306Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.917390Z", "completed_at": "2026-01-29T20:19:48.917404Z"}], "thread_id": "Thread-4", "execution_time": 0.024412870407104492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_cashflows", "compiled": true, "compiled_code": "-- Pipeline A: Simple Cashflow Pipeline\n-- Model: stg_cashflows\n-- Description: Staging model for raw cashflow data\n--\n\nwith source as (\n    select distinct\n        cashflow_id,\n        portfolio_id,\n        cashflow_type,\n        cashflow_date,\n        amount,\n        currency,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.cashflows\n),\n\nconverted as (\n    select\n        cashflow_id,\n        portfolio_id,\n        upper(cashflow_type) as cashflow_type,\n        cast(cashflow_date as date) as cashflow_date,\n        cast(amount as decimal(18,2)) as amount,\n        upper(currency) as currency,\n        cast(created_at as timestamp) as created_at,\n        cast(updated_at as timestamp) as updated_at\n    from source\n),\n\nfiltered as (\n    select *\n    from converted\n    where cashflow_date >= '2020-01-01'\n      and cashflow_date <= '2024-12-31'\n)\n\nselect * from filtered", "relation_name": "DBT_DEMO.DEV_pipeline_a.stg_cashflows", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.905275Z", "completed_at": "2026-01-29T20:19:48.916749Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.918281Z", "completed_at": "2026-01-29T20:19:48.918290Z"}], "thread_id": "Thread-2", "execution_time": 0.026893138885498047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_benchmarks", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: stg_benchmarks\n-- Description: Benchmark index data for performance comparison\n\nwith source as (\n    select\n        benchmark_id,\n        benchmark_name,\n        benchmark_ticker,\n        asset_class,\n        region,\n        is_active,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.benchmarks\n),\n\ndeduplicated as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (partition by benchmark_id order by updated_at desc) as rn\n        from source\n    )\n    where rn = 1\n)\n\nselect\n    benchmark_id,\n    trim(benchmark_name) as benchmark_name,\n    upper(trim(benchmark_ticker)) as benchmark_ticker,\n    upper(asset_class) as asset_class,\n    upper(region) as region,\n    is_active,\n    created_at,\n    updated_at\nfrom deduplicated\nwhere is_active = true", "relation_name": "DBT_DEMO.DEV_pipeline_c.stg_benchmarks", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.894552Z", "completed_at": "2026-01-29T20:19:48.917094Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.918823Z", "completed_at": "2026-01-29T20:19:48.918829Z"}], "thread_id": "Thread-1", "execution_time": 0.028548240661621094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_benchmark_returns", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: stg_benchmark_returns\n-- Description: Daily benchmark return data\n--\n\nwith source as (\n    select\n        benchmark_id,\n        return_date,\n        daily_return,\n        index_level,\n        created_at\n    from DBT_DEMO.DEV.benchmark_returns\n    where return_date >= '2020-01-01'\n),\n\nwith_cumulative as (\n    select\n        benchmark_id,\n        return_date,\n        daily_return,\n        index_level,\n        exp(sum(ln(1 + daily_return)) over (\n            partition by benchmark_id\n            order by return_date\n            rows between unbounded preceding and current row\n        )) - 1 as cumulative_return,\n        exp(sum(ln(1 + daily_return)) over (\n            partition by benchmark_id\n            order by return_date\n            rows between 29 preceding and current row\n        )) - 1 as return_30d,\n        exp(sum(ln(1 + daily_return)) over (\n            partition by benchmark_id\n            order by return_date\n            rows between 89 preceding and current row\n        )) - 1 as return_90d,\n        exp(sum(ln(1 + daily_return)) over (\n            partition by benchmark_id\n            order by return_date\n            rows between 364 preceding and current row\n        )) - 1 as return_1y,\n        stddev(daily_return) over (\n            partition by benchmark_id\n            order by return_date\n            rows between 251 preceding and current row\n        ) * sqrt(252) as annualized_volatility,\n        created_at\n    from source\n)\n\nselect * from with_cumulative", "relation_name": "DBT_DEMO.DEV_pipeline_c.stg_benchmark_returns", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.908189Z", "completed_at": "2026-01-29T20:19:48.917979Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.919742Z", "completed_at": "2026-01-29T20:19:48.919749Z"}], "thread_id": "Thread-3", "execution_time": 0.02765512466430664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_brokers", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: stg_brokers\n-- Description: Staging model for broker information\n\nwith source as (\n    select\n        broker_id,\n        broker_name,\n        broker_type,\n        region,\n        is_active,\n        commission_rate,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.brokers\n),\n\ndeduplicated as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (partition by broker_id order by updated_at desc) as rn\n        from source\n    )\n    where rn = 1\n)\n\nselect\n    broker_id,\n    trim(broker_name) as broker_name,\n    upper(broker_type) as broker_type,\n    upper(region) as region,\n    is_active,\n    commission_rate,\n    created_at,\n    updated_at\nfrom deduplicated\nwhere is_active = true", "relation_name": "DBT_DEMO.DEV_pipeline_b.stg_brokers", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.923657Z", "completed_at": "2026-01-29T20:19:48.936169Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.936496Z", "completed_at": "2026-01-29T20:19:48.936504Z"}], "thread_id": "Thread-4", "execution_time": 0.015487194061279297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_fund_hierarchy", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: stg_fund_hierarchy\n-- Description: Fund and portfolio hierarchy for roll-up reporting\n\nwith source as (\n    select\n        entity_id,\n        entity_name,\n        entity_type,\n        parent_entity_id,\n        hierarchy_level,\n        is_active,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.fund_hierarchy\n)\n\nselect\n    entity_id,\n    trim(entity_name) as entity_name,\n    upper(entity_type) as entity_type,\n    parent_entity_id,\n    hierarchy_level,\n    is_active,\n    created_at,\n    updated_at\nfrom source\nwhere is_active = true", "relation_name": "DBT_DEMO.DEV_pipeline_c.stg_fund_hierarchy", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.926888Z", "completed_at": "2026-01-29T20:19:48.937815Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.939004Z", "completed_at": "2026-01-29T20:19:48.939012Z"}], "thread_id": "Thread-2", "execution_time": 0.01729416847229004, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_market_prices", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: stg_market_prices\n-- Description: Staging model for daily market prices\n--\n\nwith source as (\n    select\n        security_id,\n        price_date,\n        open_price,\n        high_price,\n        low_price,\n        close_price,\n        volume,\n        created_at\n    from DBT_DEMO.DEV.market_prices\n    where price_date >= '2020-01-01'\n),\n\nwith_prior_day as (\n    select\n        curr.security_id,\n        curr.price_date,\n        curr.open_price,\n        curr.high_price,\n        curr.low_price,\n        curr.close_price,\n        curr.volume,\n        prev.close_price as prior_close,\n        prev.volume as prior_volume\n    from source curr\n    left join source prev\n        on curr.security_id = prev.security_id\n        and curr.price_date = dateadd('day', 1, prev.price_date)\n),\n\nwith_returns as (\n    select\n        *,\n        -- Daily return\n        case\n            when prior_close > 0\n            then (close_price - prior_close) / prior_close\n            else null\n        end as daily_return,\n        avg(close_price) over (\n            partition by security_id\n            order by price_date\n            rows between 19 preceding and current row\n        ) as ma_20,\n        avg(close_price) over (\n            partition by security_id\n            order by price_date\n            rows between 49 preceding and current row\n        ) as ma_50,\n        avg(close_price) over (\n            partition by security_id\n            order by price_date\n            rows between 199 preceding and current row\n        ) as ma_200,\n        stddev(close_price) over (\n            partition by security_id\n            order by price_date\n            rows between 19 preceding and current row\n        ) as volatility_20d,\n        avg(volume) over (\n            partition by security_id\n            order by price_date\n            rows between 19 preceding and current row\n        ) as avg_volume_20d\n    from with_prior_day\n),\n\nfinal as (\n    select\n        *,\n        case\n            when ma_20 > ma_50 and ma_50 > ma_200 then 'BULLISH'\n            when ma_20 < ma_50 and ma_50 < ma_200 then 'BEARISH'\n            else 'NEUTRAL'\n        end as trend_signal,\n        case\n            when volume > avg_volume_20d * 2 then 'HIGH'\n            when volume < avg_volume_20d * 0.5 then 'LOW'\n            else 'NORMAL'\n        end as volume_signal\n    from with_returns\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_b.stg_market_prices", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.929974Z", "completed_at": "2026-01-29T20:19:48.938098Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.939558Z", "completed_at": "2026-01-29T20:19:48.939565Z"}], "thread_id": "Thread-1", "execution_time": 0.017512798309326172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_portfolio_benchmarks", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: stg_portfolio_benchmarks\n-- Description: Mapping of portfolios to their benchmarks\n\nwith source as (\n    select\n        portfolio_id,\n        benchmark_id,\n        is_primary,\n        start_date,\n        end_date,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.portfolio_benchmarks\n)\n\nselect\n    portfolio_id,\n    benchmark_id,\n    is_primary,\n    cast(start_date as date) as start_date,\n    cast(end_date as date) as end_date,\n    created_at,\n    updated_at\nfrom source\nwhere end_date is null or end_date >= current_date()", "relation_name": "DBT_DEMO.DEV_pipeline_c.stg_portfolio_benchmarks", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.932914Z", "completed_at": "2026-01-29T20:19:48.938645Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.944531Z", "completed_at": "2026-01-29T20:19:48.944538Z"}], "thread_id": "Thread-3", "execution_time": 0.021860122680664062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_portfolios", "compiled": true, "compiled_code": "-- Pipeline A: Simple Cashflow Pipeline\n-- Model: stg_portfolios\n-- Description: Staging model for portfolio master data\n--\n\nwith source as (\n    select\n        portfolio_id,\n        portfolio_name,\n        portfolio_type,\n        fund_id,\n        inception_date,\n        status,\n        currency,\n        created_at,\n        updated_at,\n        row_number() over (\n            partition by portfolio_id\n            order by updated_at desc\n        ) as rn\n    from DBT_DEMO.DEV.portfolios\n),\n\ndeduplicated as (\n    select\n        portfolio_id,\n        portfolio_name,\n        portfolio_type,\n        fund_id,\n        inception_date,\n        status,\n        currency,\n        created_at,\n        updated_at\n    from source\n    where rn = 1\n),\n\nactive_only as (\n    select *\n    from deduplicated\n    where status = 'ACTIVE'\n)\n\nselect * from active_only", "relation_name": "DBT_DEMO.DEV_pipeline_a.stg_portfolios", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.940066Z", "completed_at": "2026-01-29T20:19:48.947552Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.948766Z", "completed_at": "2026-01-29T20:19:48.948772Z"}], "thread_id": "Thread-4", "execution_time": 0.01140284538269043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_positions_daily", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: stg_positions_daily\n-- Description: Daily position snapshots from source system\n--\n\nwith source as (\n    select\n        position_id,\n        portfolio_id,\n        security_id,\n        position_date,\n        quantity,\n        cost_basis_price,\n        cost_basis_value,\n        market_price,\n        market_value,\n        market_value_usd,\n        unrealized_pnl,\n        unrealized_pnl_pct,\n        weight_pct,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.positions_daily\n),\n\ntransformed as (\n    select\n        position_id,\n        portfolio_id,\n        security_id,\n        cast(position_date as date) as position_date,\n        cast(quantity as decimal(18,6)) as quantity,\n        cast(cost_basis_price as decimal(18,4)) as cost_basis_price,\n        cast(cost_basis_value as decimal(18,2)) as cost_basis_value,\n        cast(market_price as decimal(18,4)) as market_price,\n        cast(market_value as decimal(18,2)) as market_value,\n        cast(market_value_usd as decimal(18,2)) as market_value_usd,\n        cast(unrealized_pnl as decimal(18,2)) as unrealized_pnl,\n        cast(unrealized_pnl_pct as decimal(10,4)) as unrealized_pnl_pct,\n        cast(market_value_usd as decimal(18,2))\n            / nullif(sum(cast(market_value_usd as decimal(18,2))) over (\n                partition by portfolio_id, cast(position_date as date)\n            ), 0) as weight_pct,\n        created_at,\n        updated_at\n    from source\n),\n\nfiltered as (\n    select *\n    from transformed\n    where position_date >= '2020-01-01'\n)\n\nselect * from filtered", "relation_name": "DBT_DEMO.DEV_pipeline_c.stg_positions_daily", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.949253Z", "completed_at": "2026-01-29T20:19:48.959392Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.962128Z", "completed_at": "2026-01-29T20:19:48.962135Z"}], "thread_id": "Thread-2", "execution_time": 0.015855789184570312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_securities", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: stg_securities\n-- Description: Staging model for security master data\n--\n\nwith source as (\n    select\n        security_id,\n        ticker,\n        security_name,\n        security_type,\n        asset_class,\n        sector,\n        industry,\n        currency,\n        exchange,\n        is_active,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.securities\n),\n\ndeduplicated as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (\n                partition by security_id\n                order by updated_at desc\n            ) as rn\n        from source\n    ) sub\n    where rn = 1\n),\n\nstandardized as (\n    select\n        security_id,\n        upper(trim(ticker)) as ticker,\n        trim(security_name) as security_name,\n        case\n            when security_type in ('STOCK', 'EQUITY', 'COMMON') then 'EQUITY'\n            when security_type in ('BOND', 'NOTE', 'DEBENTURE') then 'FIXED_INCOME'\n            when security_type in ('OPTION', 'FUTURE', 'SWAP') then 'DERIVATIVE'\n            when security_type in ('ETF', 'MUTUAL_FUND') then 'FUND'\n            else 'OTHER'\n        end as security_type_standardized,\n        security_type as security_type_original,\n        upper(asset_class) as asset_class,\n        sector,\n        industry,\n        upper(currency) as currency,\n        exchange,\n        is_active,\n        created_at,\n        updated_at\n    from deduplicated\n)\n\nselect * from standardized\nwhere is_active = true", "relation_name": "DBT_DEMO.DEV_pipeline_b.stg_securities", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.955162Z", "completed_at": "2026-01-29T20:19:48.959679Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.962937Z", "completed_at": "2026-01-29T20:19:48.962943Z"}], "thread_id": "Thread-3", "execution_time": 0.015770673751831055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_valuations", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: stg_valuations\n-- Description: Portfolio valuation data (NAV, etc.)\n--\n\nwith source as (\n    select\n        valuation_id,\n        portfolio_id,\n        valuation_date,\n        nav,\n        nav_per_share,\n        shares_outstanding,\n        gross_assets,\n        total_liabilities,\n        net_assets,\n        currency,\n        fx_rate_to_usd,\n        nav_usd,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.valuations\n),\n\ndeduplicated as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (\n                partition by portfolio_id, valuation_date\n                order by updated_at desc\n            ) as rn\n        from source\n    )\n    where rn = 1\n),\n\nfiltered as (\n    select\n        valuation_id,\n        portfolio_id,\n        cast(valuation_date as date) as valuation_date,\n        cast(nav as decimal(18,2)) as nav,\n        cast(nav_per_share as decimal(18,6)) as nav_per_share,\n        cast(shares_outstanding as decimal(18,6)) as shares_outstanding,\n        cast(gross_assets as decimal(18,2)) as gross_assets,\n        cast(total_liabilities as decimal(18,2)) as total_liabilities,\n        cast(net_assets as decimal(18,2)) as net_assets,\n        upper(currency) as currency,\n        cast(fx_rate_to_usd as decimal(18,8)) as fx_rate_to_usd,\n        cast(nav_usd as decimal(18,2)) as nav_usd,\n        created_at,\n        updated_at\n    from deduplicated\n    where valuation_date >= '2020-01-01'\n)\n\nselect * from filtered", "relation_name": "DBT_DEMO.DEV_pipeline_c.stg_valuations", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.959975Z", "completed_at": "2026-01-29T20:19:48.961782Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.963431Z", "completed_at": "2026-01-29T20:19:48.963438Z"}], "thread_id": "Thread-4", "execution_time": 0.004830837249755859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.bain_capital_portfolio_analytics.dim_date", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.952212Z", "completed_at": "2026-01-29T20:19:48.962638Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.964310Z", "completed_at": "2026-01-29T20:19:48.964318Z"}], "thread_id": "Thread-1", "execution_time": 0.01749396324157715, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.stg_trades", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: stg_trades\n-- Description: Staging model for trade transactions\n--\n\nwith source as (\n    select\n        trade_id,\n        portfolio_id,\n        security_id,\n        broker_id,\n        trade_date,\n        settlement_date,\n        trade_type,\n        quantity,\n        price,\n        gross_amount,\n        commission,\n        fees,\n        net_amount,\n        currency,\n        created_at,\n        updated_at\n    from DBT_DEMO.DEV.trades\n),\n\ncategorized as (\n    select\n        *,\n        case\n            when trade_type in ('BUY', 'COVER') then 'PURCHASE'\n            when trade_type in ('SELL', 'SHORT') then 'SALE'\n            when trade_type in ('DIVIDEND', 'INTEREST') then 'INCOME'\n            else 'OTHER'\n        end as trade_category,\n        case\n            when abs(net_amount) >= 10000000 then 'LARGE'\n            when abs(net_amount) >= 1000000 then 'MEDIUM'\n            when abs(net_amount) >= 100000 then 'SMALL'\n            else 'MICRO'\n        end as trade_size_bucket,\n        upper(trim(trade_type)) as trade_type_clean,\n        upper(trim(currency)) as currency_clean\n    from source\n),\n\nwith_dates as (\n    select\n        *,\n        datediff('day', trade_date, settlement_date) as settlement_days,\n        date_trunc('month', trade_date) as trade_month,\n        date_trunc('quarter', trade_date) as trade_quarter,\n        extract(year from trade_date) as trade_year,\n        extract(month from trade_date) as trade_month_num,\n        dayofweek(trade_date) as trade_day_of_week\n    from categorized\n),\n\nfiltered as (\n    select *\n    from with_dates\n    where trade_date >= '2020-01-01'\n)\n\nselect * from filtered", "relation_name": "DBT_DEMO.DEV_pipeline_b.stg_trades", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.968711Z", "completed_at": "2026-01-29T20:19:48.971400Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.976016Z", "completed_at": "2026-01-29T20:19:48.976023Z"}], "thread_id": "Thread-2", "execution_time": 0.010249137878417969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.bain_capital_portfolio_analytics.sample_benchmarks", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.971998Z", "completed_at": "2026-01-29T20:19:48.973725Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.978503Z", "completed_at": "2026-01-29T20:19:48.978509Z"}], "thread_id": "Thread-3", "execution_time": 0.01197195053100586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.bain_capital_portfolio_analytics.sample_fund_hierarchy", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.974054Z", "completed_at": "2026-01-29T20:19:48.975696Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.979006Z", "completed_at": "2026-01-29T20:19:48.979011Z"}], "thread_id": "Thread-4", "execution_time": 0.011929988861083984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.bain_capital_portfolio_analytics.sample_portfolios", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.976543Z", "completed_at": "2026-01-29T20:19:48.978176Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:48.979868Z", "completed_at": "2026-01-29T20:19:48.979885Z"}], "thread_id": "Thread-1", "execution_time": 0.012182950973510742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.bain_capital_portfolio_analytics.sample_securities", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.999980Z", "completed_at": "2026-01-29T20:19:49.004148Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.004479Z", "completed_at": "2026-01-29T20:19:49.004489Z"}], "thread_id": "Thread-1", "execution_time": 0.02181696891784668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_cashflows_portfolio_id.7214b80713", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV.cashflows\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.991477Z", "completed_at": "2026-01-29T20:19:49.005000Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.006023Z", "completed_at": "2026-01-29T20:19:49.006030Z"}], "thread_id": "Thread-3", "execution_time": 0.02428579330444336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_brokers_broker_id.fc3dc7f740", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect broker_id\nfrom DBT_DEMO.DEV.brokers\nwhere broker_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.994980Z", "completed_at": "2026-01-29T20:19:49.005318Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.006815Z", "completed_at": "2026-01-29T20:19:49.006821Z"}], "thread_id": "Thread-4", "execution_time": 0.024734973907470703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_cashflows_cashflow_id.6651a9dff6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cashflow_id\nfrom DBT_DEMO.DEV.cashflows\nwhere cashflow_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:48.983636Z", "completed_at": "2026-01-29T20:19:49.006508Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.008001Z", "completed_at": "2026-01-29T20:19:49.008008Z"}], "thread_id": "Thread-2", "execution_time": 0.02694225311279297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_benchmarks_benchmark_id.77da05fad0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect benchmark_id\nfrom DBT_DEMO.DEV.benchmarks\nwhere benchmark_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.010254Z", "completed_at": "2026-01-29T20:19:49.027180Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.027591Z", "completed_at": "2026-01-29T20:19:49.027600Z"}], "thread_id": "Thread-1", "execution_time": 0.0203702449798584, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_fund_hierarchy_entity_id.f609f2324a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect entity_id\nfrom DBT_DEMO.DEV.fund_hierarchy\nwhere entity_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.015169Z", "completed_at": "2026-01-29T20:19:49.028117Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.029485Z", "completed_at": "2026-01-29T20:19:49.029491Z"}], "thread_id": "Thread-3", "execution_time": 0.020394086837768555, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_portfolios_portfolio_id.7e4d584a28", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV.portfolios\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.022602Z", "completed_at": "2026-01-29T20:19:49.028824Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.030346Z", "completed_at": "2026-01-29T20:19:49.030351Z"}], "thread_id": "Thread-2", "execution_time": 0.015987157821655273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_securities_security_id.abb5e35888", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect security_id\nfrom DBT_DEMO.DEV.securities\nwhere security_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.019051Z", "completed_at": "2026-01-29T20:19:49.029185Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.030835Z", "completed_at": "2026-01-29T20:19:49.030841Z"}], "thread_id": "Thread-4", "execution_time": 0.021004915237426758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_positions_daily_position_id.2be41ed62f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect position_id\nfrom DBT_DEMO.DEV.positions_daily\nwhere position_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.032955Z", "completed_at": "2026-01-29T20:19:49.041444Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.050315Z", "completed_at": "2026-01-29T20:19:49.050324Z"}], "thread_id": "Thread-1", "execution_time": 0.020401716232299805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_trades_trade_id.91bde43312", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_id\nfrom DBT_DEMO.DEV.trades\nwhere trade_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.037955Z", "completed_at": "2026-01-29T20:19:49.056824Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.057257Z", "completed_at": "2026-01-29T20:19:49.057267Z"}], "thread_id": "Thread-3", "execution_time": 0.02471780776977539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_not_null_raw_valuations_valuation_id.f858bb70a0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect valuation_id\nfrom DBT_DEMO.DEV.valuations\nwhere valuation_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.041746Z", "completed_at": "2026-01-29T20:19:49.057872Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.058875Z", "completed_at": "2026-01-29T20:19:49.058882Z"}], "thread_id": "Thread-2", "execution_time": 0.022615909576416016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_benchmarks_benchmark_id.2277bc9816", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    benchmark_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.benchmarks\nwhere benchmark_id is not null\ngroup by benchmark_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.046960Z", "completed_at": "2026-01-29T20:19:49.058174Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.059669Z", "completed_at": "2026-01-29T20:19:49.059675Z"}], "thread_id": "Thread-4", "execution_time": 0.02307581901550293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_brokers_broker_id.507c2d6af4", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    broker_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.brokers\nwhere broker_id is not null\ngroup by broker_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.051992Z", "completed_at": "2026-01-29T20:19:49.059380Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.060821Z", "completed_at": "2026-01-29T20:19:49.060827Z"}], "thread_id": "Thread-1", "execution_time": 0.009536027908325195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_cashflows_cashflow_id.556586c346", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    cashflow_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.cashflows\nwhere cashflow_id is not null\ngroup by cashflow_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.062936Z", "completed_at": "2026-01-29T20:19:49.074891Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.078823Z", "completed_at": "2026-01-29T20:19:49.078833Z"}], "thread_id": "Thread-3", "execution_time": 0.018745899200439453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_fund_hierarchy_entity_id.c824e56e3d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    entity_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.fund_hierarchy\nwhere entity_id is not null\ngroup by entity_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.067579Z", "completed_at": "2026-01-29T20:19:49.079350Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.080181Z", "completed_at": "2026-01-29T20:19:49.080188Z"}], "thread_id": "Thread-2", "execution_time": 0.018330097198486328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_portfolios_portfolio_id.711c6adde9", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    portfolio_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.portfolios\nwhere portfolio_id is not null\ngroup by portfolio_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.075256Z", "completed_at": "2026-01-29T20:19:49.080715Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.082026Z", "completed_at": "2026-01-29T20:19:49.082033Z"}], "thread_id": "Thread-1", "execution_time": 0.015197992324829102, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_securities_security_id.ace17ee9f5", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    security_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.securities\nwhere security_id is not null\ngroup by security_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.071363Z", "completed_at": "2026-01-29T20:19:49.081315Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.082812Z", "completed_at": "2026-01-29T20:19:49.082817Z"}], "thread_id": "Thread-4", "execution_time": 0.020261764526367188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_positions_daily_position_id.f643c4f375", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    position_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.positions_daily\nwhere position_id is not null\ngroup by position_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.083956Z", "completed_at": "2026-01-29T20:19:49.094005Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.101661Z", "completed_at": "2026-01-29T20:19:49.101670Z"}], "thread_id": "Thread-3", "execution_time": 0.020741939544677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_trades_trade_id.7a1e2a7012", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trade_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.trades\nwhere trade_id is not null\ngroup by trade_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.089930Z", "completed_at": "2026-01-29T20:19:49.102192Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.102961Z", "completed_at": "2026-01-29T20:19:49.102970Z"}], "thread_id": "Thread-2", "execution_time": 0.01975393295288086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.source_unique_raw_valuations_valuation_id.0efff2ba78", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    valuation_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV.valuations\nwhere valuation_id is not null\ngroup by valuation_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.094345Z", "completed_at": "2026-01-29T20:19:49.104286Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.105492Z", "completed_at": "2026-01-29T20:19:49.105498Z"}], "thread_id": "Thread-1", "execution_time": 0.01637101173400879, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.accepted_values_stg_cashflows_cashflow_type__CONTRIBUTION__DISTRIBUTION__DIVIDEND__FEE.d3b48fa192", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        cashflow_type as value_field,\n        count(*) as n_records\n\n    from DBT_DEMO.DEV_pipeline_a.stg_cashflows\n    group by cashflow_type\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'CONTRIBUTION','DISTRIBUTION','DIVIDEND','FEE'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.097954Z", "completed_at": "2026-01-29T20:19:49.104595Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.105999Z", "completed_at": "2026-01-29T20:19:49.106006Z"}], "thread_id": "Thread-4", "execution_time": 0.01650094985961914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_cashflows_amount.333b517880", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect amount\nfrom DBT_DEMO.DEV_pipeline_a.stg_cashflows\nwhere amount is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.106509Z", "completed_at": "2026-01-29T20:19:49.116587Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.117579Z", "completed_at": "2026-01-29T20:19:49.117587Z"}], "thread_id": "Thread-3", "execution_time": 0.014111042022705078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_cashflows_cashflow_date.d05a251154", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cashflow_date\nfrom DBT_DEMO.DEV_pipeline_a.stg_cashflows\nwhere cashflow_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.110935Z", "completed_at": "2026-01-29T20:19:49.118092Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.126050Z", "completed_at": "2026-01-29T20:19:49.126059Z"}], "thread_id": "Thread-2", "execution_time": 0.02097487449645996, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_cashflows_cashflow_id.4176024898", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cashflow_id\nfrom DBT_DEMO.DEV_pipeline_a.stg_cashflows\nwhere cashflow_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.118395Z", "completed_at": "2026-01-29T20:19:49.127582Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.128857Z", "completed_at": "2026-01-29T20:19:49.128863Z"}], "thread_id": "Thread-1", "execution_time": 0.013151884078979492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_cashflows_portfolio_id.cbd1d93e57", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_a.stg_cashflows\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.122149Z", "completed_at": "2026-01-29T20:19:49.128565Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.134140Z", "completed_at": "2026-01-29T20:19:49.134150Z"}], "thread_id": "Thread-4", "execution_time": 0.018078088760375977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_stg_cashflows_cashflow_id.359e4f4704", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    cashflow_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_a.stg_cashflows\nwhere cashflow_id is not null\ngroup by cashflow_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.129359Z", "completed_at": "2026-01-29T20:19:49.139560Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.140625Z", "completed_at": "2026-01-29T20:19:49.140635Z"}], "thread_id": "Thread-3", "execution_time": 0.013997793197631836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.accepted_values_stg_market_prices_trend_signal__BULLISH__BEARISH__NEUTRAL.61dc2d3f2b", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        trend_signal as value_field,\n        count(*) as n_records\n\n    from DBT_DEMO.DEV_pipeline_b.stg_market_prices\n    group by trend_signal\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'BULLISH','BEARISH','NEUTRAL'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.135201Z", "completed_at": "2026-01-29T20:19:49.145344Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.151300Z", "completed_at": "2026-01-29T20:19:49.151309Z"}], "thread_id": "Thread-2", "execution_time": 0.023155927658081055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.dbt_utils_accepted_range_stg_market_prices_close_price__0.e3d7513f81", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from DBT_DEMO.DEV_pipeline_b.stg_market_prices\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not close_price >= 0\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.141590Z", "completed_at": "2026-01-29T20:19:49.152636Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.153784Z", "completed_at": "2026-01-29T20:19:49.153792Z"}], "thread_id": "Thread-1", "execution_time": 0.014747142791748047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_market_prices_close_price.9b82d432ca", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect close_price\nfrom DBT_DEMO.DEV_pipeline_b.stg_market_prices\nwhere close_price is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.146098Z", "completed_at": "2026-01-29T20:19:49.154312Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.159105Z", "completed_at": "2026-01-29T20:19:49.159112Z"}], "thread_id": "Thread-4", "execution_time": 0.01930999755859375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_market_prices_price_date.301b839d0d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect price_date\nfrom DBT_DEMO.DEV_pipeline_b.stg_market_prices\nwhere price_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.154618Z", "completed_at": "2026-01-29T20:19:49.165313Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.166428Z", "completed_at": "2026-01-29T20:19:49.166436Z"}], "thread_id": "Thread-3", "execution_time": 0.014664888381958008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_market_prices_security_id.8c3b87bce2", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect security_id\nfrom DBT_DEMO.DEV_pipeline_b.stg_market_prices\nwhere security_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.159678Z", "completed_at": "2026-01-29T20:19:49.166951Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.171406Z", "completed_at": "2026-01-29T20:19:49.171414Z"}], "thread_id": "Thread-2", "execution_time": 0.01809096336364746, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_cashflow_summary", "compiled": true, "compiled_code": "-- Pipeline A: Simple Cashflow Pipeline\n-- Model: fact_cashflow_summary\n-- Description: Fact table summarizing cashflows by portfolio and month\n--\n\nwith cashflows as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_cashflows\n),\n\nportfolios as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n),\n\njoined as (\n    select\n        c.cashflow_id,\n        c.portfolio_id,\n        p.portfolio_name,\n        p.portfolio_type,\n        p.fund_id,\n        c.cashflow_type,\n        c.cashflow_date,\n        c.amount,\n        c.currency,\n        date_trunc('month', c.cashflow_date) as cashflow_month,\n        date_trunc('quarter', c.cashflow_date) as cashflow_quarter,\n        date_trunc('year', c.cashflow_date) as cashflow_year,\n        extract(year from c.cashflow_date) as year_num,\n        extract(month from c.cashflow_date) as month_num,\n        extract(quarter from c.cashflow_date) as quarter_num,\n        extract(dayofmonth from c.cashflow_date) as day_num\n    from cashflows c\n    inner join portfolios p\n        on c.portfolio_id = p.portfolio_id\n),\n\naggregated as (\n    select\n        portfolio_id,\n        portfolio_name,\n        portfolio_type,\n        fund_id,\n        cashflow_month,\n        cashflow_quarter,\n        cashflow_year,\n        year_num,\n        month_num,\n        quarter_num,\n        cashflow_type,\n        currency,\n        count(*) as transaction_count,\n        count(distinct cashflow_id) as unique_transactions,\n        sum(amount) as total_amount,\n        avg(amount) as avg_amount,\n        min(amount) as min_amount,\n        max(amount) as max_amount,\n        stddev(amount) as stddev_amount,\n        percentile_cont(0.25) within group (order by amount) as p25_amount,\n        percentile_cont(0.50) within group (order by amount) as median_amount,\n        percentile_cont(0.75) within group (order by amount) as p75_amount\n    from joined\n    group by 1,2,3,4,5,6,7,8,9,10,11,12\n),\n\nwith_prior_months as (\n    select\n        agg.*,\n        agg_m1.total_amount as prior_1m_total,\n        agg_m1.transaction_count as prior_1m_count,\n        agg_m3.total_amount as prior_3m_total,\n        agg_m6.total_amount as prior_6m_total,\n        agg_m12.total_amount as prior_12m_total\n    from aggregated agg\n    left join aggregated agg_m1\n        on agg.portfolio_id = agg_m1.portfolio_id\n        and agg.cashflow_type = agg_m1.cashflow_type\n        and agg.currency = agg_m1.currency\n        and agg_m1.cashflow_month = dateadd(month, -1, agg.cashflow_month)\n    left join aggregated agg_m3\n        on agg.portfolio_id = agg_m3.portfolio_id\n        and agg.cashflow_type = agg_m3.cashflow_type\n        and agg.currency = agg_m3.currency\n        and agg_m3.cashflow_month = dateadd(month, -3, agg.cashflow_month)\n    left join aggregated agg_m6\n        on agg.portfolio_id = agg_m6.portfolio_id\n        and agg.cashflow_type = agg_m6.cashflow_type\n        and agg.currency = agg_m6.currency\n        and agg_m6.cashflow_month = dateadd(month, -6, agg.cashflow_month)\n    left join aggregated agg_m12\n        on agg.portfolio_id = agg_m12.portfolio_id\n        and agg.cashflow_type = agg_m12.cashflow_type\n        and agg.currency = agg_m12.currency\n        and agg_m12.cashflow_month = dateadd(month, -12, agg.cashflow_month)\n),\n\nwith_window_calcs as (\n    select\n        wpm.*,\n        sum(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between unbounded preceding and current row\n        ) as cumulative_total,\n        sum(transaction_count) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between unbounded preceding and current row\n        ) as cumulative_count,\n        avg(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between 2 preceding and current row\n        ) as rolling_3m_avg,\n        avg(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between 5 preceding and current row\n        ) as rolling_6m_avg,\n        avg(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between 11 preceding and current row\n        ) as rolling_12m_avg,\n        stddev(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between 11 preceding and current row\n        ) as rolling_12m_stddev,\n        min(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between 11 preceding and current row\n        ) as rolling_12m_min,\n        max(total_amount) over (\n            partition by wpm.portfolio_id, wpm.cashflow_type, wpm.currency\n            order by wpm.cashflow_month\n            rows between 11 preceding and current row\n        ) as rolling_12m_max\n    from with_prior_months wpm\n),\n\nwith_fund_context as (\n    select\n        wwc.*,\n        (\n            select sum(total_amount)\n            from aggregated agg2\n            inner join portfolios p2\n                on agg2.portfolio_id = p2.portfolio_id\n            where p2.fund_id = wwc.fund_id\n            and agg2.cashflow_month = wwc.cashflow_month\n            and agg2.cashflow_type = wwc.cashflow_type\n        ) as fund_total_amount,\n        (\n            select count(distinct agg2.portfolio_id)\n            from aggregated agg2\n            inner join portfolios p2\n                on agg2.portfolio_id = p2.portfolio_id\n            where p2.fund_id = wwc.fund_id\n            and agg2.cashflow_month = wwc.cashflow_month\n            and agg2.cashflow_type = wwc.cashflow_type\n        ) as fund_portfolio_count\n    from with_window_calcs wwc\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(wfc.portfolio_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(wfc.cashflow_month as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(wfc.cashflow_type as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(wfc.currency as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as cashflow_summary_key,\n        wfc.*,\n        case\n            when wfc.fund_total_amount > 0\n            then (wfc.total_amount / wfc.fund_total_amount) * 100\n            else null\n        end as portfolio_share_of_fund_pct,\n        case\n            when wfc.prior_1m_total is not null and wfc.prior_1m_total != 0\n            then ((wfc.total_amount - wfc.prior_1m_total) / abs(wfc.prior_1m_total)) * 100\n            else null\n        end as mom_growth_pct,\n        case\n            when wfc.prior_3m_total is not null and wfc.prior_3m_total != 0\n            then ((wfc.total_amount - wfc.prior_3m_total) / abs(wfc.prior_3m_total)) * 100\n            else null\n        end as growth_3m_pct,\n        case\n            when wfc.prior_12m_total is not null and wfc.prior_12m_total != 0\n            then ((wfc.total_amount - wfc.prior_12m_total) / abs(wfc.prior_12m_total)) * 100\n            else null\n        end as yoy_growth_pct,\n        case\n            when wfc.rolling_3m_avg > wfc.rolling_12m_avg * 1.3 then 'ACCELERATING'\n            when wfc.rolling_3m_avg > wfc.rolling_12m_avg * 1.1 then 'GROWING'\n            when wfc.rolling_3m_avg < wfc.rolling_12m_avg * 0.7 then 'DECLINING_FAST'\n            when wfc.rolling_3m_avg < wfc.rolling_12m_avg * 0.9 then 'DECLINING'\n            else 'STABLE'\n        end as trend_classification,\n        case\n            when wfc.rolling_12m_stddev < wfc.rolling_12m_avg * 0.1 then 'LOW_VOLATILITY'\n            when wfc.rolling_12m_stddev < wfc.rolling_12m_avg * 0.3 then 'MODERATE_VOLATILITY'\n            when wfc.rolling_12m_stddev < wfc.rolling_12m_avg * 0.5 then 'HIGH_VOLATILITY'\n            else 'VERY_HIGH_VOLATILITY'\n        end as volatility_classification,\n        case\n            when abs(wfc.total_amount) >= 10000000 then 'MEGA'\n            when abs(wfc.total_amount) >= 5000000 then 'LARGE'\n            when abs(wfc.total_amount) >= 1000000 then 'MEDIUM'\n            when abs(wfc.total_amount) >= 100000 then 'SMALL'\n            else 'MICRO'\n        end as transaction_size_category\n    from with_fund_context wfc\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.167250Z", "completed_at": "2026-01-29T20:19:49.176126Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.177248Z", "completed_at": "2026-01-29T20:19:49.177257Z"}], "thread_id": "Thread-1", "execution_time": 0.012725830078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.accepted_values_stg_portfolios_status__ACTIVE__INACTIVE__CLOSED.7c5e49f046", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        status as value_field,\n        count(*) as n_records\n\n    from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n    group by status\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'ACTIVE','INACTIVE','CLOSED'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.171988Z", "completed_at": "2026-01-29T20:19:49.177779Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.184014Z", "completed_at": "2026-01-29T20:19:49.184023Z"}], "thread_id": "Thread-4", "execution_time": 0.018056869506835938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_portfolios_portfolio_id.7126a480ec", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_a.stg_portfolios\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.178078Z", "completed_at": "2026-01-29T20:19:49.189787Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.190796Z", "completed_at": "2026-01-29T20:19:49.190804Z"}], "thread_id": "Thread-3", "execution_time": 0.015505790710449219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_portfolios_portfolio_name.667840ac9c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_name\nfrom DBT_DEMO.DEV_pipeline_a.stg_portfolios\nwhere portfolio_name is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.184607Z", "completed_at": "2026-01-29T20:19:49.194775Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.195821Z", "completed_at": "2026-01-29T20:19:49.195828Z"}], "thread_id": "Thread-2", "execution_time": 0.019006013870239258, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.relationships_stg_cashflows_portfolio_id__portfolio_id__ref_stg_portfolios_.9f0a1fd1ba", "compiled": true, "compiled_code": "\n    \n    \n\nwith child as (\n    select portfolio_id as from_field\n    from DBT_DEMO.DEV_pipeline_a.stg_cashflows\n    where portfolio_id is not null\n),\n\nparent as (\n    select portfolio_id as to_field\n    from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.191318Z", "completed_at": "2026-01-29T20:19:49.200555Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.201611Z", "completed_at": "2026-01-29T20:19:49.201617Z"}], "thread_id": "Thread-1", "execution_time": 0.01271200180053711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_stg_portfolios_portfolio_id.aa125b6658", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    portfolio_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_a.stg_portfolios\nwhere portfolio_id is not null\ngroup by portfolio_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.196413Z", "completed_at": "2026-01-29T20:19:49.202492Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.206936Z", "completed_at": "2026-01-29T20:19:49.206942Z"}], "thread_id": "Thread-4", "execution_time": 0.01659679412841797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_positions_daily_portfolio_id.89e9a34f2a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_c.stg_positions_daily\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.202795Z", "completed_at": "2026-01-29T20:19:49.212870Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.213945Z", "completed_at": "2026-01-29T20:19:49.213952Z"}], "thread_id": "Thread-3", "execution_time": 0.013816118240356445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_positions_daily_position_date.c1d30d8c47", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect position_date\nfrom DBT_DEMO.DEV_pipeline_c.stg_positions_daily\nwhere position_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.207830Z", "completed_at": "2026-01-29T20:19:49.218035Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.219052Z", "completed_at": "2026-01-29T20:19:49.219059Z"}], "thread_id": "Thread-2", "execution_time": 0.016998767852783203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_positions_daily_position_id.5376c0b852", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect position_id\nfrom DBT_DEMO.DEV_pipeline_c.stg_positions_daily\nwhere position_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.214479Z", "completed_at": "2026-01-29T20:19:49.223831Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.224874Z", "completed_at": "2026-01-29T20:19:49.224882Z"}], "thread_id": "Thread-1", "execution_time": 0.017455101013183594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_positions_daily_security_id.3dde029ee5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect security_id\nfrom DBT_DEMO.DEV_pipeline_c.stg_positions_daily\nwhere security_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.219569Z", "completed_at": "2026-01-29T20:19:49.228579Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.229744Z", "completed_at": "2026-01-29T20:19:49.229752Z"}], "thread_id": "Thread-4", "execution_time": 0.016272306442260742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_stg_positions_daily_position_id.37818d6471", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    position_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.stg_positions_daily\nwhere position_id is not null\ngroup by position_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.225396Z", "completed_at": "2026-01-29T20:19:49.235195Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.236291Z", "completed_at": "2026-01-29T20:19:49.236300Z"}], "thread_id": "Thread-3", "execution_time": 0.013250112533569336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_position_attribution", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_position_attribution\n-- Description: Attribution analysis at position level\n--\n\nwith positions as (\n    select * from DBT_DEMO.DEV_pipeline_c.stg_positions_daily\n),\n\nsecurities as (\n    select * from DBT_DEMO.DEV_pipeline_b.stg_securities\n),\n\nmarket_prices as (\n    select * from DBT_DEMO.DEV_pipeline_b.stg_market_prices\n),\n\nenriched_positions as (\n    select\n        p.portfolio_id,\n        p.security_id,\n        p.position_date,\n        p.quantity,\n        p.market_value_usd,\n        p.weight_pct,\n        s.ticker,\n        s.security_type_standardized as security_type,\n        s.asset_class,\n        s.sector,\n        s.industry,\n        mp.daily_return as security_return,\n        mp.close_price,\n        mp.ma_20,\n        mp.ma_50,\n        mp.volatility_20d\n    from positions p\n    inner join securities s\n        on p.security_id = s.security_id\n    left join market_prices mp\n        on p.security_id = mp.security_id\n        and p.position_date = mp.price_date\n),\n\nwith_prior_weight as (\n    select\n        *,\n        lag(weight_pct, 1) over (\n            partition by portfolio_id, security_id\n            order by position_date\n        ) as prior_weight_pct,\n        lag(market_value_usd, 1) over (\n            partition by portfolio_id, security_id\n            order by position_date\n        ) as prior_market_value\n    from enriched_positions\n),\n\nwith_attribution as (\n    select\n        *,\n        -- Contribution to return\n        coalesce(prior_weight_pct, weight_pct) * coalesce(security_return, 0) as contribution_to_return,\n        -- Allocation effect (simplified Brinson)\n        (weight_pct - coalesce(prior_weight_pct, weight_pct)) * coalesce(security_return, 0) as allocation_effect,\n        -- Position P&L\n        market_value_usd - coalesce(prior_market_value, market_value_usd) as position_pnl\n    from with_prior_weight\n)\n\nselect * from with_attribution", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_position_attribution", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.230327Z", "completed_at": "2026-01-29T20:19:49.236817Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.242529Z", "completed_at": "2026-01-29T20:19:49.242536Z"}], "thread_id": "Thread-2", "execution_time": 0.018098831176757812, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.accepted_values_stg_securities_security_type_standardized__EQUITY__FIXED_INCOME__DERIVATIVE__FUND__OTHER.3e7dc8b60d", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        security_type_standardized as value_field,\n        count(*) as n_records\n\n    from DBT_DEMO.DEV_pipeline_b.stg_securities\n    group by security_type_standardized\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'EQUITY','FIXED_INCOME','DERIVATIVE','FUND','OTHER'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.237126Z", "completed_at": "2026-01-29T20:19:49.247604Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.248622Z", "completed_at": "2026-01-29T20:19:49.248631Z"}], "thread_id": "Thread-1", "execution_time": 0.01426386833190918, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_securities_security_id.f91b0934be", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect security_id\nfrom DBT_DEMO.DEV_pipeline_b.stg_securities\nwhere security_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.243172Z", "completed_at": "2026-01-29T20:19:49.252786Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.253777Z", "completed_at": "2026-01-29T20:19:49.253784Z"}], "thread_id": "Thread-4", "execution_time": 0.01794290542602539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_securities_ticker.57595820c3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect ticker\nfrom DBT_DEMO.DEV_pipeline_b.stg_securities\nwhere ticker is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.249158Z", "completed_at": "2026-01-29T20:19:49.257741Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.258729Z", "completed_at": "2026-01-29T20:19:49.258736Z"}], "thread_id": "Thread-3", "execution_time": 0.012078046798706055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_stg_securities_security_id.92fe74e630", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    security_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.stg_securities\nwhere security_id is not null\ngroup by security_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.254293Z", "completed_at": "2026-01-29T20:19:49.259683Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.263861Z", "completed_at": "2026-01-29T20:19:49.263868Z"}], "thread_id": "Thread-2", "execution_time": 0.01568317413330078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_benchmark_aligned", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_benchmark_aligned\n-- Description: Align benchmark returns with portfolio dates for comparison\n--\n\nwith portfolio_dates as (\n    select distinct\n        portfolio_id,\n        valuation_date\n    from DBT_DEMO.DEV_pipeline_c.stg_valuations\n),\n\nportfolio_benchmarks as (\n    select * from DBT_DEMO.DEV_pipeline_c.stg_portfolio_benchmarks\n),\n\nbenchmark_returns as (\n    select * from DBT_DEMO.DEV_pipeline_c.stg_benchmark_returns\n),\n\naligned as (\n    select\n        pd.portfolio_id,\n        pd.valuation_date,\n        pb.benchmark_id,\n        1.0 as benchmark_weight,  -- Default weight since not in source\n        pb.is_primary,\n        br.daily_return as benchmark_daily_return,\n        br.cumulative_return as benchmark_cumulative_return,\n        br.return_30d as benchmark_return_30d,\n        br.return_90d as benchmark_return_90d,\n        br.return_1y as benchmark_return_1y,\n        br.annualized_volatility as benchmark_volatility\n    from portfolio_dates pd\n    inner join portfolio_benchmarks pb\n        on pd.portfolio_id = pb.portfolio_id\n        and pd.valuation_date >= pb.start_date\n        and (pb.end_date is null or pd.valuation_date <= pb.end_date)\n    left join benchmark_returns br\n        on pb.benchmark_id = br.benchmark_id\n        and pd.valuation_date = br.return_date\n)\n\nselect * from aligned", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_benchmark_aligned", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.259981Z", "completed_at": "2026-01-29T20:19:49.270487Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.274660Z", "completed_at": "2026-01-29T20:19:49.274671Z"}], "thread_id": "Thread-1", "execution_time": 0.01734018325805664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_portfolio_returns_daily", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_portfolio_returns_daily\n-- Description: Calculate daily portfolio returns from NAV\n--\n\nwith valuations as (\n    select * from DBT_DEMO.DEV_pipeline_c.stg_valuations\n),\n\ncashflows as (\n    select\n        portfolio_id,\n        cashflow_date,\n        sum(case when cashflow_type = 'CONTRIBUTION' then amount else 0 end) as contributions,\n        sum(case when cashflow_type = 'DISTRIBUTION' then amount else 0 end) as distributions\n    from DBT_DEMO.DEV_pipeline_a.stg_cashflows\n    group by 1, 2\n),\n\nwith_prior_nav as (\n    select\n        curr.portfolio_id,\n        curr.valuation_date,\n        curr.nav,\n        curr.nav_usd,\n        prev.nav as prior_nav,\n        prev.nav_usd as prior_nav_usd,\n        coalesce(cf.contributions, 0) as contributions,\n        coalesce(cf.distributions, 0) as distributions\n    from valuations curr\n    left join valuations prev\n        on curr.portfolio_id = prev.portfolio_id\n        and curr.valuation_date = dateadd('day', 1, prev.valuation_date)\n    left join cashflows cf\n        on curr.portfolio_id = cf.portfolio_id\n        and curr.valuation_date = cf.cashflow_date\n),\n\nwith_daily_return as (\n    select\n        portfolio_id,\n        valuation_date,\n        nav,\n        nav_usd,\n        prior_nav,\n        prior_nav_usd,\n        contributions,\n        distributions,\n        -- Simple return\n        case\n            when prior_nav > 0\n            then (nav - prior_nav - contributions + distributions) / prior_nav\n            else null\n        end as daily_return_simple,\n        -- Modified Dietz (approximation)\n        case\n            when (prior_nav + contributions * 0.5) > 0\n            then (nav - prior_nav - contributions + distributions) / (prior_nav + contributions * 0.5 - distributions * 0.5)\n            else null\n        end as daily_return_mod_dietz\n    from with_prior_nav\n),\n\nwith_rolling_returns as (\n    select\n        *,\n        -- Cumulative return using log returns\n        exp(sum(ln(1 + coalesce(daily_return_mod_dietz, 0))) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between unbounded preceding and current row\n        )) - 1 as cumulative_return,\n        -- Rolling period returns\n        exp(sum(ln(1 + coalesce(daily_return_mod_dietz, 0))) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 6 preceding and current row\n        )) - 1 as return_1w,\n        exp(sum(ln(1 + coalesce(daily_return_mod_dietz, 0))) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 29 preceding and current row\n        )) - 1 as return_1m,\n        exp(sum(ln(1 + coalesce(daily_return_mod_dietz, 0))) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 89 preceding and current row\n        )) - 1 as return_3m,\n        exp(sum(ln(1 + coalesce(daily_return_mod_dietz, 0))) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 179 preceding and current row\n        )) - 1 as return_6m,\n        exp(sum(ln(1 + coalesce(daily_return_mod_dietz, 0))) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 364 preceding and current row\n        )) - 1 as return_1y,\n        -- Rolling volatility\n        stddev(daily_return_mod_dietz) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 29 preceding and current row\n        ) * sqrt(252) as volatility_1m,\n        stddev(daily_return_mod_dietz) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 251 preceding and current row\n        ) * sqrt(252) as volatility_1y\n    from with_daily_return\n)\n\nselect * from with_rolling_returns", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_portfolio_returns_daily", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.264794Z", "completed_at": "2026-01-29T20:19:49.275215Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.276279Z", "completed_at": "2026-01-29T20:19:49.276285Z"}], "thread_id": "Thread-4", "execution_time": 0.017112016677856445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.dbt_utils_accepted_range_stg_valuations_nav_usd__0.cdcff35ae0", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from DBT_DEMO.DEV_pipeline_c.stg_valuations\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not nav_usd >= 0\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.271189Z", "completed_at": "2026-01-29T20:19:49.280480Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.281564Z", "completed_at": "2026-01-29T20:19:49.281572Z"}], "thread_id": "Thread-3", "execution_time": 0.01721811294555664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_valuations_nav_usd.e351b70ae7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect nav_usd\nfrom DBT_DEMO.DEV_pipeline_c.stg_valuations\nwhere nav_usd is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.276913Z", "completed_at": "2026-01-29T20:19:49.282845Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.287437Z", "completed_at": "2026-01-29T20:19:49.287444Z"}], "thread_id": "Thread-2", "execution_time": 0.016664981842041016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_valuations_valuation_id.88ca70781d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect valuation_id\nfrom DBT_DEMO.DEV_pipeline_c.stg_valuations\nwhere valuation_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.283518Z", "completed_at": "2026-01-29T20:19:49.292469Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.296866Z", "completed_at": "2026-01-29T20:19:49.296876Z"}], "thread_id": "Thread-1", "execution_time": 0.016172170639038086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_stg_valuations_valuation_id.fce7eb13b5", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    valuation_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.stg_valuations\nwhere valuation_id is not null\ngroup by valuation_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.288345Z", "completed_at": "2026-01-29T20:19:49.297382Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.298411Z", "completed_at": "2026-01-29T20:19:49.298418Z"}], "thread_id": "Thread-4", "execution_time": 0.01598072052001953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_trades_enriched", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: int_trades_enriched\n-- Description: Intermediate model enriching trades with security and price data\n--\n\nwith trades as (\n    select * from DBT_DEMO.DEV_pipeline_b.stg_trades\n),\n\nsecurities as (\n    select * from DBT_DEMO.DEV_pipeline_b.stg_securities\n),\n\nmarket_prices as (\n    select * from DBT_DEMO.DEV_pipeline_b.stg_market_prices\n),\n\nbrokers as (\n    select * from DBT_DEMO.DEV_pipeline_b.stg_brokers\n),\n\nenriched as (\n    select\n        t.trade_id,\n        t.portfolio_id,\n        t.security_id,\n        t.trade_date,\n        t.settlement_date,\n        t.trade_type,\n        t.trade_category,\n        t.trade_size_bucket,\n        t.quantity,\n        t.price as execution_price,\n        t.gross_amount,\n        t.commission,\n        t.fees,\n        t.net_amount,\n        t.currency,\n        t.settlement_days,\n        t.trade_month,\n        t.trade_quarter,\n        t.trade_year,\n        -- Security attributes\n        s.ticker,\n        s.security_name,\n        s.security_type_standardized as security_type,\n        s.asset_class,\n        s.sector,\n        s.industry,\n        -- Broker attributes\n        b.broker_name,\n        b.broker_type,\n        b.region as broker_region,\n        b.commission_rate as standard_commission_rate,\n        -- Market price on trade date\n        mp.close_price as market_close_price,\n        mp.ma_20,\n        mp.ma_50,\n        mp.volatility_20d,\n        mp.trend_signal,\n        mp.volume_signal,\n        case\n            when mp.close_price > 0\n            then (t.price - mp.close_price) / mp.close_price * 100\n            else null\n        end as execution_vs_close_pct,\n        case\n            when t.price > mp.close_price then 'ABOVE_MARKET'\n            when t.price < mp.close_price then 'BELOW_MARKET'\n            else 'AT_MARKET'\n        end as execution_quality,\n        -- Cost analysis\n        t.commission + t.fees as total_costs,\n        case\n            when t.gross_amount > 0\n            then (t.commission + t.fees) / t.gross_amount * 10000\n            else null\n        end as cost_bps\n    from trades t\n    inner join securities s\n        on t.security_id = s.security_id\n    left join brokers b\n        on t.broker_id = b.broker_id\n    left join market_prices mp\n        on t.security_id = mp.security_id\n        and t.trade_date = mp.price_date\n)\n\nselect * from enriched", "relation_name": "DBT_DEMO.DEV_pipeline_b.int_trades_enriched", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.293175Z", "completed_at": "2026-01-29T20:19:49.303849Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.304977Z", "completed_at": "2026-01-29T20:19:49.304984Z"}], "thread_id": "Thread-3", "execution_time": 0.01711893081665039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.accepted_values_stg_trades_trade_category__PURCHASE__SALE__INCOME__OTHER.198f663cac", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        trade_category as value_field,\n        count(*) as n_records\n\n    from DBT_DEMO.DEV_pipeline_b.stg_trades\n    group by trade_category\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'PURCHASE','SALE','INCOME','OTHER'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.300276Z", "completed_at": "2026-01-29T20:19:49.306153Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.310542Z", "completed_at": "2026-01-29T20:19:49.310548Z"}], "thread_id": "Thread-2", "execution_time": 0.017798900604248047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.accepted_values_stg_trades_trade_size_bucket__LARGE__MEDIUM__SMALL__MICRO.211accc343", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        trade_size_bucket as value_field,\n        count(*) as n_records\n\n    from DBT_DEMO.DEV_pipeline_b.stg_trades\n    group by trade_size_bucket\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'LARGE','MEDIUM','SMALL','MICRO'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.306766Z", "completed_at": "2026-01-29T20:19:49.315735Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.319847Z", "completed_at": "2026-01-29T20:19:49.319856Z"}], "thread_id": "Thread-1", "execution_time": 0.015778064727783203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_trades_portfolio_id.2becbd2a0b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_b.stg_trades\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.311408Z", "completed_at": "2026-01-29T20:19:49.320366Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.321361Z", "completed_at": "2026-01-29T20:19:49.321369Z"}], "thread_id": "Thread-4", "execution_time": 0.015621185302734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_trades_security_id.86be87f7ab", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect security_id\nfrom DBT_DEMO.DEV_pipeline_b.stg_trades\nwhere security_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.316428Z", "completed_at": "2026-01-29T20:19:49.325278Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.326335Z", "completed_at": "2026-01-29T20:19:49.326342Z"}], "thread_id": "Thread-3", "execution_time": 0.015372991561889648, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_trades_trade_date.42ba31e712", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_date\nfrom DBT_DEMO.DEV_pipeline_b.stg_trades\nwhere trade_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.321909Z", "completed_at": "2026-01-29T20:19:49.327515Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.333313Z", "completed_at": "2026-01-29T20:19:49.333320Z"}], "thread_id": "Thread-2", "execution_time": 0.017303943634033203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_stg_trades_trade_id.f81937320b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_id\nfrom DBT_DEMO.DEV_pipeline_b.stg_trades\nwhere trade_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.328141Z", "completed_at": "2026-01-29T20:19:49.337914Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.342204Z", "completed_at": "2026-01-29T20:19:49.342210Z"}], "thread_id": "Thread-1", "execution_time": 0.016696929931640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_stg_trades_trade_id.f973ed6ffd", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trade_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.stg_trades\nwhere trade_id is not null\ngroup by trade_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.334301Z", "completed_at": "2026-01-29T20:19:49.343035Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.347131Z", "completed_at": "2026-01-29T20:19:49.347138Z"}], "thread_id": "Thread-4", "execution_time": 0.020023822784423828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.report_monthly_cashflows", "compiled": true, "compiled_code": "-- Pipeline A: Simple Cashflow Pipeline\n-- Model: report_monthly_cashflows\n-- Description: LP reporting view for monthly cashflow analysis\n--\n\nwith fact_data as (\n    select * from DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\n),\n\nmonthly_totals as (\n    select\n        portfolio_id,\n        portfolio_name,\n        portfolio_type,\n        fund_id,\n        cashflow_month,\n        year_num,\n        month_num,\n        sum(case when cashflow_type = 'CONTRIBUTION' then total_amount else 0 end) as contributions,\n        sum(case when cashflow_type = 'DISTRIBUTION' then total_amount else 0 end) as distributions,\n        sum(case when cashflow_type = 'DIVIDEND' then total_amount else 0 end) as dividends,\n        sum(case when cashflow_type = 'FEE' then total_amount else 0 end) as fees,\n        sum(total_amount) as total_cashflow,\n        sum(transaction_count) as total_transactions\n    from fact_data\n    group by 1,2,3,4,5,6,7\n),\n\nwith_running_totals as (\n    select\n        *,\n        -- Running totals (repeated pattern)\n        sum(contributions) over (\n            partition by portfolio_id\n            order by cashflow_month\n            rows between unbounded preceding and current row\n        ) as cumulative_contributions,\n        sum(distributions) over (\n            partition by portfolio_id\n            order by cashflow_month\n            rows between unbounded preceding and current row\n        ) as cumulative_distributions,\n        sum(total_cashflow) over (\n            partition by portfolio_id\n            order by cashflow_month\n            rows between unbounded preceding and current row\n        ) as cumulative_net_cashflow,\n        -- Prior period comparisons (another repeated pattern)\n        lag(contributions, 1) over (partition by portfolio_id order by cashflow_month) as prior_month_contributions,\n        lag(distributions, 1) over (partition by portfolio_id order by cashflow_month) as prior_month_distributions,\n        lag(total_cashflow, 1) over (partition by portfolio_id order by cashflow_month) as prior_month_total,\n        -- YoY comparison\n        lag(contributions, 12) over (partition by portfolio_id order by cashflow_month) as prior_year_contributions,\n        lag(distributions, 12) over (partition by portfolio_id order by cashflow_month) as prior_year_distributions\n    from monthly_totals\n),\n\nfinal as (\n    select\n        *,\n        contributions - coalesce(prior_month_contributions, 0) as mom_contribution_change,\n        distributions - coalesce(prior_month_distributions, 0) as mom_distribution_change,\n        case\n            when prior_year_contributions > 0\n            then (contributions - prior_year_contributions) / prior_year_contributions * 100\n            else null\n        end as yoy_contribution_pct_change,\n        contributions - distributions as net_inflow\n    from with_running_totals\n)\n\nselect * from final\norder by portfolio_id, cashflow_month", "relation_name": "DBT_DEMO.DEV_pipeline_a.report_monthly_cashflows", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.338574Z", "completed_at": "2026-01-29T20:19:49.347631Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.348701Z", "completed_at": "2026-01-29T20:19:49.348709Z"}], "thread_id": "Thread-3", "execution_time": 0.014955997467041016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.dbt_utils_accepted_range_fact_cashflow_summary_transaction_count__0.4582b1b384", "compiled": true, "compiled_code": "\n\nwith meet_condition as(\n  select *\n  from DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\n),\n\nvalidation_errors as (\n  select *\n  from meet_condition\n  where\n    -- never true, defaults to an empty result set. Exists to ensure any combo of the `or` clauses below succeeds\n    1 = 2\n    -- records with a value >= min_value are permitted. The `not` flips this to find records that don't meet the rule.\n    or not transaction_count >= 0\n)\n\nselect *\nfrom validation_errors\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.343741Z", "completed_at": "2026-01-29T20:19:49.349625Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.354282Z", "completed_at": "2026-01-29T20:19:49.354290Z"}], "thread_id": "Thread-2", "execution_time": 0.016132831573486328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_cashflow_summary_cashflow_summary_key.eda3fa76d3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cashflow_summary_key\nfrom DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\nwhere cashflow_summary_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.350637Z", "completed_at": "2026-01-29T20:19:49.360856Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.365299Z", "completed_at": "2026-01-29T20:19:49.365305Z"}], "thread_id": "Thread-1", "execution_time": 0.017441749572753906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_cashflow_summary_portfolio_id.625a7cad74", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.355829Z", "completed_at": "2026-01-29T20:19:49.366146Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.369496Z", "completed_at": "2026-01-29T20:19:49.369502Z"}], "thread_id": "Thread-4", "execution_time": 0.019626140594482422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_cashflow_summary_cashflow_summary_key.b4868fe991", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    cashflow_summary_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\nwhere cashflow_summary_key is not null\ngroup by cashflow_summary_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.361521Z", "completed_at": "2026-01-29T20:19:49.370357Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.371393Z", "completed_at": "2026-01-29T20:19:49.371400Z"}], "thread_id": "Thread-3", "execution_time": 0.016368865966796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_position_snapshot", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: fact_position_snapshot\n-- Description: Position-level fact table with attribution\n--\n\nwith position_attribution as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_position_attribution\n),\n\nportfolios as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(pa.portfolio_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pa.security_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(pa.position_date as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as position_snapshot_key,\n        p.portfolio_name,\n        p.portfolio_type,\n        p.fund_id,\n        pa.portfolio_id,\n        pa.security_id,\n        pa.position_date,\n        pa.ticker,\n        pa.security_type,\n        pa.asset_class,\n        pa.sector,\n        pa.industry,\n        pa.quantity,\n        pa.market_value_usd,\n        pa.weight_pct,\n        pa.close_price,\n        pa.ma_20,\n        pa.ma_50,\n        pa.volatility_20d,\n        pa.security_return,\n        pa.contribution_to_return,\n        pa.allocation_effect,\n        pa.position_pnl,\n        extract(year from pa.position_date) as position_year,\n        extract(month from pa.position_date) as position_month,\n        date_trunc('month', pa.position_date) as position_month_start\n    from position_attribution pa\n    inner join portfolios p\n        on pa.portfolio_id = p.portfolio_id\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_c.fact_position_snapshot", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.366853Z", "completed_at": "2026-01-29T20:19:49.372221Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.376307Z", "completed_at": "2026-01-29T20:19:49.376314Z"}], "thread_id": "Thread-2", "execution_time": 0.015234708786010742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_sector_attribution", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_sector_attribution\n-- Description: Aggregate attribution to sector level\n--\n\nwith position_attribution as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_position_attribution\n),\n\nsector_daily as (\n    select\n        portfolio_id,\n        position_date,\n        sector,\n        count(distinct security_id) as position_count,\n        sum(market_value_usd) as sector_market_value,\n        sum(weight_pct) as sector_weight,\n        sum(contribution_to_return) as sector_contribution,\n        sum(allocation_effect) as sector_allocation_effect,\n        sum(position_pnl) as sector_pnl,\n        avg(security_return) as avg_security_return\n    from position_attribution\n    group by 1, 2, 3\n),\n\nwith_rolling as (\n    select\n        *,\n        sum(sector_contribution) over (\n            partition by portfolio_id, sector\n            order by position_date\n            rows between 29 preceding and current row\n        ) as sector_contribution_30d,\n        avg(sector_weight) over (\n            partition by portfolio_id, sector\n            order by position_date\n            rows between 29 preceding and current row\n        ) as avg_sector_weight_30d,\n        lag(sector_weight, 1) over (\n            partition by portfolio_id, sector\n            order by position_date\n        ) as prior_sector_weight\n    from sector_daily\n)\n\nselect * from with_rolling", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_sector_attribution", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.372522Z", "completed_at": "2026-01-29T20:19:49.380457Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.381493Z", "completed_at": "2026-01-29T20:19:49.381501Z"}], "thread_id": "Thread-1", "execution_time": 0.011543750762939453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_portfolio_vs_benchmark", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_portfolio_vs_benchmark\n-- Description: Compare portfolio returns to benchmark\n--\n\nwith portfolio_returns as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_portfolio_returns_daily\n),\n\nbenchmark_aligned as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_benchmark_aligned\n    where is_primary = true\n),\n\ncombined as (\n    select\n        pr.portfolio_id,\n        pr.valuation_date,\n        pr.nav,\n        pr.nav_usd,\n        pr.daily_return_mod_dietz as portfolio_daily_return,\n        pr.cumulative_return as portfolio_cumulative_return,\n        pr.return_1m as portfolio_return_1m,\n        pr.return_3m as portfolio_return_3m,\n        pr.return_1y as portfolio_return_1y,\n        pr.volatility_1y as portfolio_volatility,\n        ba.benchmark_id,\n        ba.benchmark_daily_return,\n        ba.benchmark_cumulative_return,\n        ba.benchmark_return_30d as benchmark_return_1m,\n        ba.benchmark_return_90d as benchmark_return_3m,\n        ba.benchmark_return_1y,\n        ba.benchmark_volatility\n    from portfolio_returns pr\n    left join benchmark_aligned ba\n        on pr.portfolio_id = ba.portfolio_id\n        and pr.valuation_date = ba.valuation_date\n),\n\nwith_excess as (\n    select\n        *,\n        portfolio_daily_return - coalesce(benchmark_daily_return, 0) as daily_excess_return,\n        portfolio_cumulative_return - coalesce(benchmark_cumulative_return, 0) as cumulative_excess_return,\n        portfolio_return_1m - coalesce(benchmark_return_1m, 0) as excess_return_1m,\n        portfolio_return_3m - coalesce(benchmark_return_3m, 0) as excess_return_3m,\n        portfolio_return_1y - coalesce(benchmark_return_1y, 0) as excess_return_1y\n    from combined\n),\n\nwith_tracking_error as (\n    select\n        *,\n        stddev(daily_excess_return) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 251 preceding and current row\n        ) * sqrt(252) as tracking_error_1y,\n        avg(daily_excess_return) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 251 preceding and current row\n        ) * 252 as annualized_alpha\n    from with_excess\n),\n\nfinal as (\n    select\n        *,\n        case\n            when tracking_error_1y > 0\n            then annualized_alpha / tracking_error_1y\n            else null\n        end as information_ratio\n    from with_tracking_error\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_portfolio_vs_benchmark", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.377203Z", "completed_at": "2026-01-29T20:19:49.386730Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.387758Z", "completed_at": "2026-01-29T20:19:49.387765Z"}], "thread_id": "Thread-4", "execution_time": 0.01592278480529785, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_risk_metrics", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_risk_metrics\n-- Description: Calculate risk metrics for portfolios\n--\n\nwith portfolio_returns as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_portfolio_returns_daily\n),\n\nwith_risk_metrics as (\n    select\n        portfolio_id,\n        valuation_date,\n        daily_return_mod_dietz as daily_return,\n        nav_usd,\n        -- Max drawdown components\n        max(nav_usd) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between unbounded preceding and current row\n        ) as running_max_nav,\n        -- Downside deviation\n        sqrt(avg(\n            case when daily_return_mod_dietz < 0 then power(daily_return_mod_dietz, 2) else 0 end\n        ) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 251 preceding and current row\n        )) * sqrt(252) as downside_deviation_1y,\n        -- Sortino components\n        avg(daily_return_mod_dietz) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between 251 preceding and current row\n        ) * 252 as annualized_return_1y,\n        volatility_1y\n    from portfolio_returns\n),\n\nwith_derived as (\n    select\n        *,\n        -- Drawdown\n        (nav_usd - running_max_nav) / nullif(running_max_nav, 0) as drawdown,\n        -- Sortino ratio (assuming 0% risk-free)\n        case\n            when downside_deviation_1y > 0\n            then annualized_return_1y / downside_deviation_1y\n            else null\n        end as sortino_ratio,\n        -- Sharpe ratio (assuming 0% risk-free)\n        case\n            when volatility_1y > 0\n            then annualized_return_1y / volatility_1y\n            else null\n        end as sharpe_ratio\n    from with_risk_metrics\n),\n\nwith_max_drawdown as (\n    select\n        *,\n        min(drawdown) over (\n            partition by portfolio_id\n            order by valuation_date\n            rows between unbounded preceding and current row\n        ) as max_drawdown\n    from with_derived\n),\n\nfinal as (\n    select\n        *,\n        -- Parametric VaR (95%)\n        nav_usd * volatility_1y / sqrt(252) * 1.645 as var_95_1d,\n        -- Parametric VaR (99%)\n        nav_usd * volatility_1y / sqrt(252) * 2.326 as var_99_1d\n    from with_max_drawdown\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_risk_metrics", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.382050Z", "completed_at": "2026-01-29T20:19:49.392397Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.393489Z", "completed_at": "2026-01-29T20:19:49.393495Z"}], "thread_id": "Thread-3", "execution_time": 0.016694068908691406, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_int_portfolio_returns_daily_portfolio_id.fb4b042394", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_c.int_portfolio_returns_daily\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.388263Z", "completed_at": "2026-01-29T20:19:49.393976Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.397696Z", "completed_at": "2026-01-29T20:19:49.397702Z"}], "thread_id": "Thread-2", "execution_time": 0.016613006591796875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_int_portfolio_returns_daily_valuation_date.6a699754ae", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect valuation_date\nfrom DBT_DEMO.DEV_pipeline_c.int_portfolio_returns_daily\nwhere valuation_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.394264Z", "completed_at": "2026-01-29T20:19:49.402315Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.403294Z", "completed_at": "2026-01-29T20:19:49.403301Z"}], "thread_id": "Thread-1", "execution_time": 0.011639118194580078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_trade_pnl", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: int_trade_pnl\n-- Description: Calculate P&L for each trade\n--\n\nwith trades as (\n    select * from DBT_DEMO.DEV_pipeline_b.int_trades_enriched\n),\n\npositions as (\n    select\n        trade_id,\n        portfolio_id,\n        security_id,\n        ticker,\n        security_name,\n        security_type,\n        asset_class,\n        sector,\n        industry,\n        trade_date,\n        trade_type,\n        trade_category,\n        quantity,\n        execution_price,\n        net_amount,\n        commission,\n        sum(case\n            when trade_category = 'PURCHASE' then quantity\n            when trade_category = 'SALE' then -quantity\n            else 0\n        end) over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n            rows between unbounded preceding and current row\n        ) as running_position,\n        sum(case\n            when trade_category = 'PURCHASE' then net_amount\n            when trade_category = 'SALE' then -net_amount\n            else 0\n        end) over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n            rows between unbounded preceding and current row\n        ) as cumulative_cost,\n        sum(case when trade_category = 'PURCHASE' then quantity else 0 end) over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n            rows between unbounded preceding and current row\n        ) as cumulative_purchased_qty,\n        sum(case when trade_category = 'PURCHASE' then net_amount else 0 end) over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n            rows between unbounded preceding and current row\n        ) as cumulative_purchase_cost\n    from trades\n),\n\nwith_cost_basis as (\n    select\n        *,\n        case\n            when cumulative_purchased_qty > 0\n            then cumulative_purchase_cost / cumulative_purchased_qty\n            else null\n        end as avg_cost_basis\n    from positions\n),\n\nwith_pnl as (\n    select\n        *,\n        case\n            when trade_category = 'SALE' and avg_cost_basis is not null\n            then (execution_price - avg_cost_basis) * quantity\n            else null\n        end as realized_pnl,\n        case\n            when trade_category = 'SALE' and avg_cost_basis is not null and avg_cost_basis > 0\n            then (execution_price - avg_cost_basis) / avg_cost_basis * 100\n            else null\n        end as realized_pnl_pct\n    from with_cost_basis\n)\n\nselect * from with_pnl", "relation_name": "DBT_DEMO.DEV_pipeline_b.int_trade_pnl", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.398243Z", "completed_at": "2026-01-29T20:19:49.403806Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.408132Z", "completed_at": "2026-01-29T20:19:49.408138Z"}], "thread_id": "Thread-4", "execution_time": 0.015060901641845703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_int_trades_enriched_trade_id.ffac9962a6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_id\nfrom DBT_DEMO.DEV_pipeline_b.int_trades_enriched\nwhere trade_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.404106Z", "completed_at": "2026-01-29T20:19:49.413117Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.414205Z", "completed_at": "2026-01-29T20:19:49.414211Z"}], "thread_id": "Thread-3", "execution_time": 0.012686967849731445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_int_trades_enriched_trade_id.3338eab4a7", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trade_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.int_trades_enriched\nwhere trade_id is not null\ngroup by trade_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.408776Z", "completed_at": "2026-01-29T20:19:49.414703Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.418947Z", "completed_at": "2026-01-29T20:19:49.418953Z"}], "thread_id": "Thread-2", "execution_time": 0.016067981719970703, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.assert_cashflow_balance", "compiled": true, "compiled_code": "-- Test: Cashflow totals should balance at portfolio level\n-- Validates that contributions - distributions = net cashflow\n\nwith cashflow_totals as (\n    select\n        portfolio_id,\n        sum(contributions) as total_contributions,\n        sum(distributions) as total_distributions,\n        sum(net_inflow) as total_net_inflow\n    from DBT_DEMO.DEV_pipeline_a.report_monthly_cashflows\n    group by portfolio_id\n)\n\nselect *\nfrom cashflow_totals\nwhere abs(total_contributions - total_distributions - total_net_inflow) > 0.01", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.414987Z", "completed_at": "2026-01-29T20:19:49.422724Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.423751Z", "completed_at": "2026-01-29T20:19:49.423758Z"}], "thread_id": "Thread-1", "execution_time": 0.011426925659179688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_report_monthly_cashflows_portfolio_id.dbc5367687", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_a.report_monthly_cashflows\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.419492Z", "completed_at": "2026-01-29T20:19:49.424261Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.428585Z", "completed_at": "2026-01-29T20:19:49.428591Z"}], "thread_id": "Thread-4", "execution_time": 0.014781951904296875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.assert_position_weights_sum_to_one", "compiled": true, "compiled_code": "-- Test: Position weights should sum to approximately 100% per portfolio per day\n-- Allows for small rounding differences\n\nwith weight_totals as (\n    select\n        portfolio_id,\n        position_date,\n        sum(weight_pct) as total_weight\n    from DBT_DEMO.DEV_pipeline_c.fact_position_snapshot\n    group by portfolio_id, position_date\n)\n\nselect *\nfrom weight_totals\nwhere abs(total_weight - 1.0) > 0.05  -- Allow 5% tolerance for cash/derivatives", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.424537Z", "completed_at": "2026-01-29T20:19:49.433324Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.434307Z", "completed_at": "2026-01-29T20:19:49.434314Z"}], "thread_id": "Thread-3", "execution_time": 0.012331962585449219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_position_snapshot_position_snapshot_key.270d9a42ac", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect position_snapshot_key\nfrom DBT_DEMO.DEV_pipeline_c.fact_position_snapshot\nwhere position_snapshot_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.429122Z", "completed_at": "2026-01-29T20:19:49.434796Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.440617Z", "completed_at": "2026-01-29T20:19:49.440623Z"}], "thread_id": "Thread-2", "execution_time": 0.017293930053710938, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_position_snapshot_position_snapshot_key.d01dbd7b56", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    position_snapshot_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.fact_position_snapshot\nwhere position_snapshot_key is not null\ngroup by position_snapshot_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.435082Z", "completed_at": "2026-01-29T20:19:49.444936Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.445932Z", "completed_at": "2026-01-29T20:19:49.445939Z"}], "thread_id": "Thread-1", "execution_time": 0.013401031494140625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_sector_performance", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: fact_sector_performance\n-- Description: Sector-level performance aggregation\n--\n\nwith sector_attribution as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_sector_attribution\n),\n\nportfolios as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n),\n\nwith_portfolio_info as (\n    select\n        sa.*,\n        p.portfolio_name,\n        p.portfolio_type,\n        p.fund_id\n    from sector_attribution sa\n    inner join portfolios p\n        on sa.portfolio_id = p.portfolio_id\n),\n\nwith_rankings as (\n    select\n        *,\n        rank() over (\n            partition by portfolio_id, position_date\n            order by sector_weight desc\n        ) as sector_weight_rank,\n        rank() over (\n            partition by portfolio_id, position_date\n            order by sector_contribution desc\n        ) as sector_contribution_rank\n    from with_portfolio_info\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(portfolio_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(sector as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(position_date as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as sector_performance_key,\n        *,\n        case\n            when sector_weight_rank <= 3 then 'TOP_3'\n            when sector_weight_rank <= 5 then 'TOP_5'\n            else 'OTHER'\n        end as sector_weight_tier\n    from with_rankings\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_c.fact_sector_performance", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.441164Z", "completed_at": "2026-01-29T20:19:49.451040Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.452123Z", "completed_at": "2026-01-29T20:19:49.452129Z"}], "thread_id": "Thread-4", "execution_time": 0.01822805404663086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.int_fund_rollup", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: int_fund_rollup\n-- Description: Roll up portfolio metrics to fund level\n--\n\nwith fund_hierarchy as (\n    select * from DBT_DEMO.DEV_pipeline_c.stg_fund_hierarchy\n),\n\nportfolios as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n),\n\nrisk_metrics as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_risk_metrics\n),\n\n-- Get portfolio to fund mapping\nportfolio_fund_map as (\n    select\n        p.portfolio_id,\n        p.portfolio_name,\n        p.fund_id,\n        fh.entity_name as fund_name,\n        fh.parent_entity_id,\n        fh.hierarchy_level\n    from portfolios p\n    left join fund_hierarchy fh\n        on p.fund_id = fh.entity_id\n),\n\n-- Get latest risk metrics per portfolio\nlatest_metrics as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (partition by portfolio_id order by valuation_date desc) as rn\n        from risk_metrics\n    )\n    where rn = 1\n),\n\nfund_aggregated as (\n    select\n        pfm.fund_id,\n        pfm.fund_name,\n        pfm.parent_entity_id,\n        pfm.hierarchy_level,\n        lm.valuation_date,\n        count(distinct pfm.portfolio_id) as portfolio_count,\n        sum(lm.nav_usd) as total_nav_usd,\n        -- Weighted average metrics\n        sum(lm.nav_usd * lm.annualized_return_1y) / nullif(sum(lm.nav_usd), 0) as weighted_return_1y,\n        sum(lm.nav_usd * lm.volatility_1y) / nullif(sum(lm.nav_usd), 0) as weighted_volatility_1y,\n        sum(lm.nav_usd * lm.sharpe_ratio) / nullif(sum(lm.nav_usd), 0) as weighted_sharpe_ratio,\n        min(lm.max_drawdown) as worst_drawdown,\n        sum(lm.var_95_1d) as total_var_95\n    from portfolio_fund_map pfm\n    inner join latest_metrics lm\n        on pfm.portfolio_id = lm.portfolio_id\n    group by 1, 2, 3, 4, 5\n)\n\nselect * from fund_aggregated", "relation_name": "DBT_DEMO.DEV_pipeline_c.int_fund_rollup", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.446465Z", "completed_at": "2026-01-29T20:19:49.457130Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.458202Z", "completed_at": "2026-01-29T20:19:49.458209Z"}], "thread_id": "Thread-3", "execution_time": 0.014036893844604492, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_portfolio_positions", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: fact_portfolio_positions\n-- Description: Current position snapshot by portfolio and security\n-- DEPENDENCY: Uses fact_cashflow_summary from Pipeline A for portfolio cash context\n--\n\nwith trade_pnl as (\n    select * from DBT_DEMO.DEV_pipeline_b.int_trade_pnl\n),\n\n-- DEPENDENCY ON PIPELINE A: Get cashflow context for each portfolio\ncashflow_summary as (\n    select * from DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\n),\n\n-- Aggregate cashflows by portfolio to get total contributions/distributions\nportfolio_cashflows as (\n    select\n        portfolio_id,\n        sum(case when cashflow_type = 'CONTRIBUTION' then cumulative_total else 0 end) as total_contributions,\n        sum(case when cashflow_type = 'DISTRIBUTION' then abs(cumulative_total) else 0 end) as total_distributions,\n        max(cashflow_month) as last_cashflow_date\n    from cashflow_summary\n    group by portfolio_id\n),\n\nlatest_positions as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (\n                partition by portfolio_id, security_id\n                order by trade_date desc, trade_id desc\n            ) as rn\n        from trade_pnl\n    )\n    where rn = 1\n),\n\npositions_30d_ago as (\n    select\n        portfolio_id,\n        security_id,\n        running_position as position_30d_ago,\n        avg_cost_basis as cost_basis_30d_ago\n    from (\n        select\n            *,\n            row_number() over (\n                partition by portfolio_id, security_id\n                order by trade_date desc, trade_id desc\n            ) as rn\n        from trade_pnl\n        where trade_date <= dateadd(day, -30, current_date())\n    )\n    where rn = 1\n),\n\npositions_90d_ago as (\n    select\n        portfolio_id,\n        security_id,\n        running_position as position_90d_ago,\n        avg_cost_basis as cost_basis_90d_ago\n    from (\n        select\n            *,\n            row_number() over (\n                partition by portfolio_id, security_id\n                order by trade_date desc, trade_id desc\n            ) as rn\n        from trade_pnl\n        where trade_date <= dateadd(day, -90, current_date())\n    )\n    where rn = 1\n),\n\nmarket_prices as (\n    select\n        security_id,\n        close_price as current_price,\n        price_date\n    from (\n        select\n            security_id,\n            close_price,\n            price_date,\n            row_number() over (partition by security_id order by price_date desc) as rn\n        from DBT_DEMO.DEV_pipeline_b.stg_market_prices\n    )\n    where rn = 1\n),\n\nmarket_prices_30d_ago as (\n    select\n        security_id,\n        close_price as price_30d_ago\n    from (\n        select\n            security_id,\n            close_price,\n            row_number() over (partition by security_id order by price_date desc) as rn\n        from DBT_DEMO.DEV_pipeline_b.stg_market_prices\n        where price_date <= dateadd(day, -30, current_date())\n    )\n    where rn = 1\n),\n\nenriched_positions as (\n    select\n        lp.*,\n        mp.current_price,\n        mp.price_date as price_as_of_date,\n        p30.position_30d_ago,\n        p30.cost_basis_30d_ago,\n        p90.position_90d_ago,\n        p90.cost_basis_90d_ago,\n        mp30.price_30d_ago,\n        pcf.total_contributions,\n        pcf.total_distributions,\n        pcf.last_cashflow_date\n    from latest_positions lp\n    left join market_prices mp\n        on lp.security_id = mp.security_id\n    left join positions_30d_ago p30\n        on lp.portfolio_id = p30.portfolio_id\n        and lp.security_id = p30.security_id\n    left join positions_90d_ago p90\n        on lp.portfolio_id = p90.portfolio_id\n        and lp.security_id = p90.security_id\n    left join market_prices_30d_ago mp30\n        on lp.security_id = mp30.security_id\n    left join portfolio_cashflows pcf\n        on lp.portfolio_id = pcf.portfolio_id\n    where lp.running_position != 0\n),\n\nwith_portfolio_context as (\n    select\n        ep.*,\n        sum(ep.running_position * ep.current_price) over (\n            partition by ep.portfolio_id\n        ) as portfolio_total_market_value,\n        sum(ep.running_position * ep.avg_cost_basis) over (\n            partition by ep.portfolio_id\n        ) as portfolio_total_cost_basis,\n        count(*) over (\n            partition by ep.portfolio_id\n        ) as portfolio_position_count,\n        row_number() over (\n            partition by ep.portfolio_id\n            order by (ep.running_position * ep.current_price) desc\n        ) as position_size_rank,\n        row_number() over (\n            partition by ep.portfolio_id\n            order by ((ep.current_price - ep.avg_cost_basis) / nullif(ep.avg_cost_basis, 0)) desc\n        ) as position_return_rank\n    from enriched_positions ep\n),\n\nsector_aggs as (\n    select\n        portfolio_id,\n        sector,\n        sum(running_position * current_price) as sector_market_value,\n        count(*) as sector_position_count\n    from enriched_positions\n    group by 1, 2\n),\n\nwith_sector_context as (\n    select\n        wpc.*,\n        sa.sector_market_value,\n        sa.sector_position_count\n    from with_portfolio_context wpc\n    left join sector_aggs sa\n        on wpc.portfolio_id = sa.portfolio_id\n        and wpc.sector = sa.sector\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(wsc.portfolio_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(wsc.security_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as position_key,\n        wsc.portfolio_id,\n        wsc.security_id,\n        wsc.ticker,\n        wsc.security_name,\n        wsc.sector,\n        wsc.asset_class,\n        wsc.running_position as current_quantity,\n        wsc.avg_cost_basis,\n        wsc.current_price,\n        wsc.price_as_of_date,\n        -- Core calculations\n        wsc.running_position * wsc.avg_cost_basis as cost_basis_value,\n        wsc.running_position * wsc.current_price as market_value,\n        (wsc.running_position * wsc.current_price) - (wsc.running_position * wsc.avg_cost_basis) as unrealized_pnl,\n        case\n            when wsc.avg_cost_basis > 0\n            then ((wsc.current_price - wsc.avg_cost_basis) / wsc.avg_cost_basis) * 100\n            else null\n        end as unrealized_pnl_pct,\n        -- Portfolio context\n        wsc.portfolio_total_market_value,\n        wsc.portfolio_total_cost_basis,\n        wsc.portfolio_position_count,\n        case\n            when wsc.portfolio_total_market_value > 0\n            then ((wsc.running_position * wsc.current_price) / wsc.portfolio_total_market_value) * 100\n            else null\n        end as portfolio_weight_pct,\n        -- Sector context\n        wsc.sector_market_value,\n        wsc.sector_position_count,\n        case\n            when wsc.sector_market_value > 0\n            then ((wsc.running_position * wsc.current_price) / wsc.sector_market_value) * 100\n            else null\n        end as sector_weight_pct,\n        -- Historical comparison\n        wsc.position_30d_ago,\n        wsc.position_90d_ago,\n        wsc.position_30d_ago - wsc.running_position as position_change_30d,\n        wsc.position_90d_ago - wsc.running_position as position_change_90d,\n        -- Price momentum\n        wsc.price_30d_ago,\n        case\n            when wsc.price_30d_ago > 0\n            then ((wsc.current_price - wsc.price_30d_ago) / wsc.price_30d_ago) * 100\n            else null\n        end as price_change_30d_pct,\n        -- Cashflow context from Pipeline A\n        wsc.total_contributions,\n        wsc.total_distributions,\n        wsc.last_cashflow_date,\n        -- Rankings\n        wsc.position_size_rank,\n        wsc.position_return_rank,\n        case\n            when ((wsc.running_position * wsc.current_price) / nullif(wsc.portfolio_total_market_value, 0)) > 0.10 then 'CONCENTRATED'\n            when ((wsc.running_position * wsc.current_price) / nullif(wsc.portfolio_total_market_value, 0)) > 0.05 then 'SIGNIFICANT'\n            when ((wsc.running_position * wsc.current_price) / nullif(wsc.portfolio_total_market_value, 0)) > 0.02 then 'MODERATE'\n            else 'SMALL'\n        end as position_size_category,\n        wsc.cumulative_purchase_cost as total_invested,\n        current_timestamp() as snapshot_timestamp\n    from with_sector_context wsc\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_b.fact_portfolio_positions", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.452627Z", "completed_at": "2026-01-29T20:19:49.459044Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.462606Z", "completed_at": "2026-01-29T20:19:49.462614Z"}], "thread_id": "Thread-2", "execution_time": 0.017106056213378906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_trade_summary", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: fact_trade_summary\n-- Description: Fact table for trade-level analysis\n--\n\nwith trade_pnl as (\n    select * from DBT_DEMO.DEV_pipeline_b.int_trade_pnl\n),\n\nportfolios as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n),\n\nenriched as (\n    select\n        t.trade_id,\n        t.portfolio_id,\n        p.portfolio_name,\n        p.portfolio_type,\n        p.fund_id,\n        t.security_id,\n        t.ticker,\n        t.security_name,\n        t.security_type,\n        t.asset_class,\n        t.sector,\n        t.trade_date,\n        t.trade_type,\n        t.trade_category,\n        t.quantity,\n        t.execution_price,\n        t.net_amount,\n        t.commission,\n        t.running_position,\n        t.avg_cost_basis,\n        t.realized_pnl,\n        t.realized_pnl_pct,\n        extract(year from t.trade_date) as trade_year,\n        extract(month from t.trade_date) as trade_month,\n        extract(quarter from t.trade_date) as trade_quarter,\n        extract(dayofweek from t.trade_date) as trade_day_of_week,\n        date_trunc('week', t.trade_date) as trade_week,\n        date_trunc('month', t.trade_date) as trade_month_start\n    from trade_pnl t\n    left join portfolios p\n        on t.portfolio_id = p.portfolio_id\n),\n\n-- Pre-compute trade sequence for self-join lookups\ntrade_sequences as (\n    select\n        *,\n        row_number() over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n        ) as trade_seq\n    from enriched\n),\n\nwith_prior_trades as (\n    select\n        ts.*,\n        ts_prior.execution_price as prior_trade_price,\n        ts_prior.trade_date as prior_trade_date,\n        ts_prior.quantity as prior_trade_quantity,\n        ts_5.execution_price as price_5_trades_ago,\n        ts_10.execution_price as price_10_trades_ago\n    from trade_sequences ts\n    left join trade_sequences ts_prior\n        on ts.portfolio_id = ts_prior.portfolio_id\n        and ts.security_id = ts_prior.security_id\n        and ts_prior.trade_seq = ts.trade_seq - 1\n    left join trade_sequences ts_5\n        on ts.portfolio_id = ts_5.portfolio_id\n        and ts.security_id = ts_5.security_id\n        and ts_5.trade_seq = ts.trade_seq - 5\n    left join trade_sequences ts_10\n        on ts.portfolio_id = ts_10.portfolio_id\n        and ts.security_id = ts_10.security_id\n        and ts_10.trade_seq = ts.trade_seq - 10\n),\n\nwith_window_calcs as (\n    select\n        wpt.*,\n        sum(quantity) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between unbounded preceding and current row\n        ) as cumulative_quantity,\n        sum(abs(net_amount)) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between unbounded preceding and current row\n        ) as cumulative_trade_value,\n        sum(coalesce(realized_pnl, 0)) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between unbounded preceding and current row\n        ) as cumulative_realized_pnl,\n        avg(execution_price) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between 4 preceding and current row\n        ) as rolling_5_trade_avg_price,\n        avg(execution_price) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between 9 preceding and current row\n        ) as rolling_10_trade_avg_price,\n        avg(execution_price) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between 19 preceding and current row\n        ) as rolling_20_trade_avg_price,\n        stddev(execution_price) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between 9 preceding and current row\n        ) as rolling_10_trade_price_stddev,\n        count(*) over (\n            partition by wpt.portfolio_id, wpt.security_id\n            order by wpt.trade_date, wpt.trade_id\n            rows between unbounded preceding and current row\n        ) as trade_sequence_number,\n        row_number() over (\n            partition by wpt.portfolio_id, wpt.security_id, wpt.trade_category\n            order by abs(wpt.net_amount) desc\n        ) as size_rank_within_category\n    from with_prior_trades wpt\n),\n\nsecurity_trade_aggs as (\n    select\n        portfolio_id,\n        security_id,\n        trade_date,\n        trade_id,\n        count(*) over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n            rows between unbounded preceding and current row\n        ) as total_portfolio_trades_this_security,\n        avg(execution_price) over (\n            partition by portfolio_id, security_id\n            order by trade_date, trade_id\n            rows between unbounded preceding and current row\n        ) as avg_portfolio_price_this_security\n    from enriched\n),\n\nfund_daily_volume as (\n    select\n        fund_id,\n        security_id,\n        trade_date,\n        sum(abs(net_amount)) as fund_total_volume_same_security_same_day\n    from enriched\n    group by 1, 2, 3\n),\n\nwith_security_context as (\n    select\n        wwc.*,\n        sta.total_portfolio_trades_this_security,\n        sta.avg_portfolio_price_this_security,\n        fdv.fund_total_volume_same_security_same_day\n    from with_window_calcs wwc\n    left join security_trade_aggs sta\n        on wwc.portfolio_id = sta.portfolio_id\n        and wwc.security_id = sta.security_id\n        and wwc.trade_id = sta.trade_id\n    left join fund_daily_volume fdv\n        on wwc.fund_id = fdv.fund_id\n        and wwc.security_id = fdv.security_id\n        and wwc.trade_date = fdv.trade_date\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(wsc.trade_id as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as trade_key,\n        wsc.*,\n        case\n            when wsc.prior_trade_price is not null and wsc.prior_trade_price > 0\n            then ((wsc.execution_price - wsc.prior_trade_price) / wsc.prior_trade_price) * 100\n            else null\n        end as price_change_from_prior_pct,\n        case\n            when wsc.price_5_trades_ago is not null and wsc.price_5_trades_ago > 0\n            then ((wsc.execution_price - wsc.price_5_trades_ago) / wsc.price_5_trades_ago) * 100\n            else null\n        end as price_change_from_5_trades_ago_pct,\n        case\n            when wsc.rolling_20_trade_avg_price is not null and wsc.rolling_20_trade_avg_price > 0\n            then ((wsc.execution_price - wsc.rolling_20_trade_avg_price) / wsc.rolling_20_trade_avg_price) * 100\n            else null\n        end as deviation_from_20_trade_avg_pct,\n        case\n            when abs(wsc.net_amount) >= 10000000 then 'BLOCK_TRADE'\n            when abs(wsc.net_amount) >= 1000000 then 'LARGE'\n            when abs(wsc.net_amount) >= 100000 then 'MEDIUM'\n            when abs(wsc.net_amount) >= 10000 then 'SMALL'\n            else 'MICRO'\n        end as trade_size_category,\n        case\n            when wsc.execution_price > wsc.rolling_10_trade_avg_price * 1.1 then 'BOUGHT_HIGH'\n            when wsc.execution_price > wsc.rolling_10_trade_avg_price * 1.03 then 'ABOVE_AVERAGE'\n            when wsc.execution_price < wsc.rolling_10_trade_avg_price * 0.9 then 'BOUGHT_LOW'\n            when wsc.execution_price < wsc.rolling_10_trade_avg_price * 0.97 then 'BELOW_AVERAGE'\n            else 'AVERAGE'\n        end as execution_quality,\n        case\n            when wsc.rolling_5_trade_avg_price > wsc.rolling_20_trade_avg_price then 'UPTREND'\n            when wsc.rolling_5_trade_avg_price < wsc.rolling_20_trade_avg_price then 'DOWNTREND'\n            else 'NEUTRAL'\n        end as price_momentum,\n        case\n            when wsc.rolling_10_trade_price_stddev < wsc.rolling_10_trade_avg_price * 0.02 then 'LOW_VOLATILITY'\n            when wsc.rolling_10_trade_price_stddev < wsc.rolling_10_trade_avg_price * 0.05 then 'MODERATE_VOLATILITY'\n            when wsc.rolling_10_trade_price_stddev < wsc.rolling_10_trade_avg_price * 0.10 then 'HIGH_VOLATILITY'\n            else 'VERY_HIGH_VOLATILITY'\n        end as price_volatility_regime,\n        case\n            when wsc.trade_sequence_number >= 100 then 'VERY_ACTIVE'\n            when wsc.trade_sequence_number >= 50 then 'ACTIVE'\n            when wsc.trade_sequence_number >= 20 then 'MODERATE'\n            when wsc.trade_sequence_number >= 5 then 'LIGHT'\n            else 'FIRST_FEW_TRADES'\n        end as trading_activity_level\n    from with_security_context wsc\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_b.fact_trade_summary", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.459332Z", "completed_at": "2026-01-29T20:19:49.467508Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.468585Z", "completed_at": "2026-01-29T20:19:49.468591Z"}], "thread_id": "Thread-1", "execution_time": 0.011857986450195312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.assert_realized_pnl_only_on_sales", "compiled": true, "compiled_code": "-- Test: Realized P&L should only exist for SALE trades\n\nselect *\nfrom DBT_DEMO.DEV_pipeline_b.int_trade_pnl\nwhere trade_category != 'SALE'\n  and realized_pnl is not null\n  and realized_pnl != 0", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.463515Z", "completed_at": "2026-01-29T20:19:49.474248Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.478303Z", "completed_at": "2026-01-29T20:19:49.478310Z"}], "thread_id": "Thread-4", "execution_time": 0.01966404914855957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_int_trade_pnl_trade_id.1759a8439d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_id\nfrom DBT_DEMO.DEV_pipeline_b.int_trade_pnl\nwhere trade_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.469089Z", "completed_at": "2026-01-29T20:19:49.479181Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.480295Z", "completed_at": "2026-01-29T20:19:49.480302Z"}], "thread_id": "Thread-3", "execution_time": 0.01717972755432129, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_int_trade_pnl_trade_id.9793685b9e", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trade_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.int_trade_pnl\nwhere trade_id is not null\ngroup by trade_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.474939Z", "completed_at": "2026-01-29T20:19:49.480778Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.485271Z", "completed_at": "2026-01-29T20:19:49.485277Z"}], "thread_id": "Thread-2", "execution_time": 0.01708698272705078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_sector_performance_sector_performance_key.59435d78c0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect sector_performance_key\nfrom DBT_DEMO.DEV_pipeline_c.fact_sector_performance\nwhere sector_performance_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.481407Z", "completed_at": "2026-01-29T20:19:49.490420Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.491420Z", "completed_at": "2026-01-29T20:19:49.491428Z"}], "thread_id": "Thread-1", "execution_time": 0.012656688690185547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_sector_performance_sector_performance_key.d515a35b99", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    sector_performance_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.fact_sector_performance\nwhere sector_performance_key is not null\ngroup by sector_performance_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.486822Z", "completed_at": "2026-01-29T20:19:49.495769Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.575047Z", "completed_at": "2026-01-29T20:19:49.575059Z"}], "thread_id": "Thread-4", "execution_time": 0.0940711498260498, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_fund_summary", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: fact_fund_summary\n-- Description: Fund-level summary metrics\n--\n\nwith fund_rollup as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_fund_rollup\n),\n\nfund_hierarchy as (\n    select * from DBT_DEMO.DEV_pipeline_c.stg_fund_hierarchy\n),\n\n-- Get parent fund info\nwith_parent as (\n    select\n        fr.*,\n        parent.entity_name as parent_fund_name\n    from fund_rollup fr\n    left join fund_hierarchy parent\n        on fr.parent_entity_id = parent.entity_id\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(fund_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(valuation_date as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as fund_summary_key,\n        fund_id,\n        fund_name,\n        parent_entity_id as parent_fund_id,\n        parent_fund_name,\n        hierarchy_level,\n        valuation_date,\n        portfolio_count,\n        total_nav_usd,\n        weighted_return_1y,\n        weighted_volatility_1y,\n        weighted_sharpe_ratio,\n        worst_drawdown,\n        total_var_95,\n        case\n            when weighted_return_1y >= 0.15 then 'HIGH'\n            when weighted_return_1y >= 0.08 then 'MEDIUM'\n            when weighted_return_1y >= 0 then 'LOW'\n            else 'NEGATIVE'\n        end as return_tier,\n        case\n            when weighted_sharpe_ratio >= 1.5 then 'EXCELLENT'\n            when weighted_sharpe_ratio >= 1.0 then 'GOOD'\n            when weighted_sharpe_ratio >= 0.5 then 'FAIR'\n            else 'POOR'\n        end as risk_adjusted_tier\n    from with_parent\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_c.fact_fund_summary", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.491952Z", "completed_at": "2026-01-29T20:19:49.576011Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.577398Z", "completed_at": "2026-01-29T20:19:49.577406Z"}], "thread_id": "Thread-3", "execution_time": 0.09137797355651855, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_portfolio_positions_position_key.eeb1a439c4", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect position_key\nfrom DBT_DEMO.DEV_pipeline_b.fact_portfolio_positions\nwhere position_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.496482Z", "completed_at": "2026-01-29T20:19:49.583688Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.585068Z", "completed_at": "2026-01-29T20:19:49.585075Z"}], "thread_id": "Thread-2", "execution_time": 0.09412693977355957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_portfolio_positions_position_key.cf0f8c96d9", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    position_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.fact_portfolio_positions\nwhere position_key is not null\ngroup by position_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.578308Z", "completed_at": "2026-01-29T20:19:49.589758Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.590787Z", "completed_at": "2026-01-29T20:19:49.590795Z"}], "thread_id": "Thread-1", "execution_time": 0.01522684097290039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.fact_portfolio_performance", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: fact_portfolio_performance\n-- Description: Main performance fact table\n-- DEPENDENCIES:\n--   - Pipeline A: fact_cashflow_summary (for cashflow context)\n--   - Pipeline B: fact_trade_summary, fact_portfolio_positions (for trading/position context)\n--\n\nwith portfolio_vs_benchmark as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_portfolio_vs_benchmark\n),\n\nrisk_metrics as (\n    select * from DBT_DEMO.DEV_pipeline_c.int_risk_metrics\n),\n\nportfolios as (\n    select * from DBT_DEMO.DEV_pipeline_a.stg_portfolios\n),\n\n-- DEPENDENCY ON PIPELINE A: Cashflow summary for capital deployment context\ncashflow_summary as (\n    select * from DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\n),\n\n-- Aggregate cashflows to portfolio level\nportfolio_cashflow_totals as (\n    select\n        portfolio_id,\n        sum(case when cashflow_type = 'CONTRIBUTION' then cumulative_total else 0 end) as total_contributions,\n        sum(case when cashflow_type = 'DISTRIBUTION' then abs(cumulative_total) else 0 end) as total_distributions,\n        sum(cumulative_total) as net_cashflow\n    from cashflow_summary\n    group by portfolio_id\n),\n\n-- DEPENDENCY ON PIPELINE B: Trade summary for trading activity context\ntrade_summary as (\n    select * from DBT_DEMO.DEV_pipeline_b.fact_trade_summary\n),\n\n-- Aggregate trades to portfolio/date level\nportfolio_trade_activity as (\n    select\n        portfolio_id,\n        trade_month_start as activity_month,\n        count(*) as trade_count,\n        sum(case when trade_category = 'PURCHASE' then abs(net_amount) else 0 end) as total_purchases,\n        sum(case when trade_category = 'SALE' then abs(net_amount) else 0 end) as total_sales,\n        sum(coalesce(realized_pnl, 0)) as realized_pnl\n    from trade_summary\n    group by portfolio_id, trade_month_start\n),\n\n-- DEPENDENCY ON PIPELINE B: Position snapshot for current holdings context\nportfolio_positions as (\n    select * from DBT_DEMO.DEV_pipeline_b.fact_portfolio_positions\n),\n\n-- Aggregate positions to portfolio level\nportfolio_position_totals as (\n    select\n        portfolio_id,\n        sum(market_value) as total_market_value,\n        sum(cost_basis_value) as total_cost_basis,\n        sum(unrealized_pnl) as total_unrealized_pnl,\n        count(*) as position_count\n    from portfolio_positions\n    group by portfolio_id\n),\n\ncombined as (\n    select\n        pvb.portfolio_id,\n        pvb.valuation_date,\n        pvb.nav,\n        pvb.nav_usd,\n        -- Portfolio returns\n        pvb.portfolio_daily_return,\n        pvb.portfolio_cumulative_return,\n        pvb.portfolio_return_1m,\n        pvb.portfolio_return_3m,\n        pvb.portfolio_return_1y,\n        pvb.portfolio_volatility,\n        -- Benchmark comparison\n        pvb.benchmark_id,\n        pvb.benchmark_daily_return,\n        pvb.benchmark_cumulative_return,\n        pvb.benchmark_return_1m,\n        pvb.benchmark_return_3m,\n        pvb.benchmark_return_1y,\n        pvb.benchmark_volatility,\n        -- Relative performance\n        pvb.daily_excess_return,\n        pvb.cumulative_excess_return,\n        pvb.excess_return_1m,\n        pvb.excess_return_3m,\n        pvb.excess_return_1y,\n        pvb.tracking_error_1y,\n        pvb.annualized_alpha,\n        pvb.information_ratio,\n        -- Risk metrics\n        rm.drawdown,\n        rm.max_drawdown,\n        rm.downside_deviation_1y,\n        rm.sharpe_ratio,\n        rm.sortino_ratio,\n        rm.var_95_1d,\n        rm.var_99_1d\n    from portfolio_vs_benchmark pvb\n    inner join risk_metrics rm\n        on pvb.portfolio_id = rm.portfolio_id\n        and pvb.valuation_date = rm.valuation_date\n),\n\nwith_prior_periods as (\n    select\n        c.*,\n        c1d.nav_usd as nav_1d_ago,\n        c1d.portfolio_cumulative_return as return_1d_ago,\n        c1w.nav_usd as nav_1w_ago,\n        c1w.portfolio_cumulative_return as return_1w_ago,\n        c1m.nav_usd as nav_1m_ago,\n        c1m.portfolio_cumulative_return as return_1m_ago,\n        c3m.nav_usd as nav_3m_ago,\n        c3m.portfolio_cumulative_return as return_3m_ago,\n        c1y.nav_usd as nav_1y_ago,\n        c1y.portfolio_cumulative_return as return_1y_ago\n    from combined c\n    left join combined c1d\n        on c.portfolio_id = c1d.portfolio_id\n        and c1d.valuation_date = dateadd(day, -1, c.valuation_date)\n    left join combined c1w\n        on c.portfolio_id = c1w.portfolio_id\n        and c1w.valuation_date = dateadd(day, -7, c.valuation_date)\n    left join combined c1m\n        on c.portfolio_id = c1m.portfolio_id\n        and c1m.valuation_date = dateadd(month, -1, c.valuation_date)\n    left join combined c3m\n        on c.portfolio_id = c3m.portfolio_id\n        and c3m.valuation_date = dateadd(month, -3, c.valuation_date)\n    left join combined c1y\n        on c.portfolio_id = c1y.portfolio_id\n        and c1y.valuation_date = dateadd(year, -1, c.valuation_date)\n),\n\nwith_rankings as (\n    select\n        wpp.*,\n        row_number() over (\n            partition by wpp.portfolio_id\n            order by wpp.portfolio_cumulative_return desc\n        ) as best_performance_rank,\n        row_number() over (\n            partition by wpp.portfolio_id\n            order by wpp.portfolio_cumulative_return asc\n        ) as worst_performance_rank,\n        row_number() over (\n            partition by wpp.portfolio_id\n            order by wpp.sharpe_ratio desc nulls last\n        ) as best_sharpe_rank,\n        dense_rank() over (\n            partition by wpp.portfolio_id\n            order by wpp.nav_usd desc\n        ) as nav_size_rank,\n        avg(wpp.portfolio_daily_return) over (\n            partition by wpp.portfolio_id\n            order by wpp.valuation_date\n            rows between 20 preceding and current row\n        ) as rolling_20d_avg_return,\n        avg(wpp.portfolio_daily_return) over (\n            partition by wpp.portfolio_id\n            order by wpp.valuation_date\n            rows between 60 preceding and current row\n        ) as rolling_60d_avg_return,\n        stddev(wpp.portfolio_daily_return) over (\n            partition by wpp.portfolio_id\n            order by wpp.valuation_date\n            rows between 20 preceding and current row\n        ) as rolling_20d_volatility,\n        stddev(wpp.portfolio_daily_return) over (\n            partition by wpp.portfolio_id\n            order by wpp.valuation_date\n            rows between 60 preceding and current row\n        ) as rolling_60d_volatility\n    from with_prior_periods wpp\n),\n\nwith_derived_metrics as (\n    select\n        wr.*,\n        case\n            when wr.portfolio_cumulative_return >= 0.50 then 'EXCEPTIONAL'\n            when wr.portfolio_cumulative_return >= 0.30 then 'EXCELLENT'\n            when wr.portfolio_cumulative_return >= 0.15 then 'VERY_GOOD'\n            when wr.portfolio_cumulative_return >= 0.05 then 'GOOD'\n            when wr.portfolio_cumulative_return >= 0.00 then 'NEUTRAL'\n            when wr.portfolio_cumulative_return >= -0.05 then 'POOR'\n            when wr.portfolio_cumulative_return >= -0.15 then 'VERY_POOR'\n            else 'UNACCEPTABLE'\n        end as performance_rating,\n        case\n            when wr.sharpe_ratio >= 3.0 then 'EXCEPTIONAL'\n            when wr.sharpe_ratio >= 2.0 then 'EXCELLENT'\n            when wr.sharpe_ratio >= 1.5 then 'VERY_GOOD'\n            when wr.sharpe_ratio >= 1.0 then 'GOOD'\n            when wr.sharpe_ratio >= 0.5 then 'NEUTRAL'\n            when wr.sharpe_ratio >= 0.0 then 'POOR'\n            else 'VERY_POOR'\n        end as risk_adjusted_rating,\n        case\n            when wr.nav_1m_ago is not null and wr.nav_1m_ago > 0\n            then (wr.nav_usd - wr.nav_1m_ago) / wr.nav_1m_ago\n            else null\n        end as nav_change_1m_pct,\n        case\n            when wr.nav_3m_ago is not null and wr.nav_3m_ago > 0\n            then (wr.nav_usd - wr.nav_3m_ago) / wr.nav_3m_ago\n            else null\n        end as nav_change_3m_pct,\n        case\n            when wr.nav_1y_ago is not null and wr.nav_1y_ago > 0\n            then (wr.nav_usd - wr.nav_1y_ago) / wr.nav_1y_ago\n            else null\n        end as nav_change_1y_pct,\n        case\n            when wr.rolling_20d_avg_return > wr.rolling_60d_avg_return then 'POSITIVE_MOMENTUM'\n            when wr.rolling_20d_avg_return < wr.rolling_60d_avg_return then 'NEGATIVE_MOMENTUM'\n            else 'NEUTRAL_MOMENTUM'\n        end as momentum_signal,\n        case\n            when wr.rolling_20d_volatility > wr.rolling_60d_volatility * 1.5 then 'HIGH_VOLATILITY'\n            when wr.rolling_20d_volatility > wr.rolling_60d_volatility * 1.2 then 'ELEVATED_VOLATILITY'\n            when wr.rolling_20d_volatility < wr.rolling_60d_volatility * 0.8 then 'LOW_VOLATILITY'\n            else 'NORMAL_VOLATILITY'\n        end as volatility_regime\n    from with_rankings wr\n),\n\npeer_return_aggs as (\n    select\n        p2.portfolio_type,\n        pvb2.valuation_date,\n        avg(pvb2.portfolio_cumulative_return) as peer_avg_return\n    from portfolio_vs_benchmark pvb2\n    inner join portfolios p2\n        on pvb2.portfolio_id = p2.portfolio_id\n    group by 1, 2\n),\n\npeer_sharpe_aggs as (\n    select\n        p2.portfolio_type,\n        rm2.valuation_date,\n        percentile_cont(0.5) within group (order by rm2.sharpe_ratio) as peer_median_sharpe\n    from risk_metrics rm2\n    inner join portfolios p2\n        on rm2.portfolio_id = p2.portfolio_id\n    group by 1, 2\n),\n\nwith_peer_comparison as (\n    select\n        wdm.*,\n        pra.peer_avg_return,\n        psa.peer_median_sharpe\n    from with_derived_metrics wdm\n    inner join portfolios p_self\n        on wdm.portfolio_id = p_self.portfolio_id\n    left join peer_return_aggs pra\n        on p_self.portfolio_type = pra.portfolio_type\n        and wdm.valuation_date = pra.valuation_date\n    left join peer_sharpe_aggs psa\n        on p_self.portfolio_type = psa.portfolio_type\n        and wdm.valuation_date = psa.valuation_date\n),\n\nfinal as (\n    select\n        md5(cast(coalesce(cast(wpc.portfolio_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(wpc.valuation_date as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as performance_key,\n        p.portfolio_name,\n        p.portfolio_type,\n        p.fund_id,\n        wpc.*,\n        extract(year from wpc.valuation_date) as valuation_year,\n        extract(month from wpc.valuation_date) as valuation_month,\n        extract(quarter from wpc.valuation_date) as valuation_quarter,\n        extract(dayofweek from wpc.valuation_date) as valuation_day_of_week,\n        extract(dayofyear from wpc.valuation_date) as valuation_day_of_year,\n        date_trunc('month', wpc.valuation_date) as valuation_month_start,\n        date_trunc('quarter', wpc.valuation_date) as valuation_quarter_start,\n        date_trunc('year', wpc.valuation_date) as valuation_year_start,\n        concat(p.portfolio_name, ' - ', wpc.valuation_date::varchar) as display_name,\n        concat('Q', extract(quarter from wpc.valuation_date), ' ', extract(year from wpc.valuation_date)) as quarter_label,\n        case\n            when wpc.portfolio_cumulative_return > wpc.peer_avg_return then 'OUTPERFORMING'\n            when wpc.portfolio_cumulative_return < wpc.peer_avg_return then 'UNDERPERFORMING'\n            else 'AT_PEER'\n        end as peer_relative_performance\n    from with_peer_comparison wpc\n    inner join portfolios p\n        on wpc.portfolio_id = p.portfolio_id\n)\n\nselect * from final", "relation_name": "DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.586013Z", "completed_at": "2026-01-29T20:19:49.594999Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.596168Z", "completed_at": "2026-01-29T20:19:49.596176Z"}], "thread_id": "Thread-4", "execution_time": 0.01828789710998535, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.report_trading_performance", "compiled": true, "compiled_code": "-- Pipeline B: Trade Analytics Pipeline\n-- Model: report_trading_performance\n-- Description: Trading performance report for IC dashboard\n--\n\nwith trades as (\n    select * from DBT_DEMO.DEV_pipeline_b.fact_trade_summary\n),\n\npositions as (\n    select * from DBT_DEMO.DEV_pipeline_b.fact_portfolio_positions\n),\n\ntrade_metrics as (\n    select\n        portfolio_id,\n        portfolio_name,\n        portfolio_type,\n        fund_id,\n        trade_year,\n        trade_month,\n        count(distinct trade_id) as trade_count,\n        count(distinct security_id) as securities_traded,\n        sum(case when trade_category = 'PURCHASE' then 1 else 0 end) as buy_count,\n        sum(case when trade_category = 'SALE' then 1 else 0 end) as sell_count,\n        sum(case when trade_category = 'PURCHASE' then net_amount else 0 end) as total_purchases,\n        sum(case when trade_category = 'SALE' then abs(net_amount) else 0 end) as total_sales,\n        sum(coalesce(realized_pnl, 0)) as total_realized_pnl,\n        avg(case when realized_pnl is not null then realized_pnl_pct else null end) as avg_realized_return_pct\n    from trades\n    group by 1,2,3,4,5,6\n),\n\nposition_metrics as (\n    select\n        portfolio_id,\n        count(distinct security_id) as position_count,\n        sum(market_value) as total_market_value,\n        sum(cost_basis_value) as total_cost_basis,\n        sum(unrealized_pnl) as total_unrealized_pnl,\n        avg(unrealized_pnl_pct) as avg_unrealized_return_pct\n    from positions\n    group by 1\n),\n\nwith_running_totals as (\n    select\n        tm.*,\n        sum(total_realized_pnl) over (\n            partition by tm.portfolio_id\n            order by tm.trade_year, tm.trade_month\n            rows between unbounded preceding and current row\n        ) as cumulative_realized_pnl,\n        sum(total_purchases) over (\n            partition by tm.portfolio_id\n            order by tm.trade_year, tm.trade_month\n            rows between unbounded preceding and current row\n        ) as cumulative_invested,\n        lag(total_realized_pnl, 1) over (\n            partition by tm.portfolio_id\n            order by tm.trade_year, tm.trade_month\n        ) as prior_month_pnl,\n        lag(trade_count, 1) over (\n            partition by tm.portfolio_id\n            order by tm.trade_year, tm.trade_month\n        ) as prior_month_trades\n    from trade_metrics tm\n),\n\nfinal as (\n    select\n        wrt.*,\n        pm.position_count,\n        pm.total_market_value,\n        pm.total_cost_basis,\n        pm.total_unrealized_pnl,\n        pm.avg_unrealized_return_pct,\n        -- Combined metrics\n        wrt.total_realized_pnl + coalesce(pm.total_unrealized_pnl, 0) as total_pnl,\n        case\n            when pm.total_cost_basis > 0\n            then ((pm.total_market_value + wrt.cumulative_realized_pnl) - pm.total_cost_basis) / pm.total_cost_basis * 100\n            else null\n        end as total_return_pct\n    from with_running_totals wrt\n    left join position_metrics pm\n        on wrt.portfolio_id = pm.portfolio_id\n)\n\nselect * from final\norder by portfolio_id, trade_year, trade_month", "relation_name": "DBT_DEMO.DEV_pipeline_b.report_trading_performance", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.591345Z", "completed_at": "2026-01-29T20:19:49.600671Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.601768Z", "completed_at": "2026-01-29T20:19:49.601776Z"}], "thread_id": "Thread-3", "execution_time": 0.01620006561279297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_trade_summary_trade_id.1d06d9eddf", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_id\nfrom DBT_DEMO.DEV_pipeline_b.fact_trade_summary\nwhere trade_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.596762Z", "completed_at": "2026-01-29T20:19:49.602661Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.608222Z", "completed_at": "2026-01-29T20:19:49.608228Z"}], "thread_id": "Thread-2", "execution_time": 0.01787281036376953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_trade_summary_trade_key.63153eb840", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect trade_key\nfrom DBT_DEMO.DEV_pipeline_b.fact_trade_summary\nwhere trade_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.602961Z", "completed_at": "2026-01-29T20:19:49.612781Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.613868Z", "completed_at": "2026-01-29T20:19:49.613877Z"}], "thread_id": "Thread-1", "execution_time": 0.01367497444152832, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_trade_summary_trade_id.b6190708fc", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trade_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.fact_trade_summary\nwhere trade_id is not null\ngroup by trade_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.609115Z", "completed_at": "2026-01-29T20:19:49.617878Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.618885Z", "completed_at": "2026-01-29T20:19:49.618892Z"}], "thread_id": "Thread-4", "execution_time": 0.01665210723876953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_trade_summary_trade_key.b4335a9680", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trade_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_b.fact_trade_summary\nwhere trade_key is not null\ngroup by trade_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.614387Z", "completed_at": "2026-01-29T20:19:49.623540Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.624534Z", "completed_at": "2026-01-29T20:19:49.624541Z"}], "thread_id": "Thread-3", "execution_time": 0.015835046768188477, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_fund_summary_fund_summary_key.2bf3e10ff0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect fund_summary_key\nfrom DBT_DEMO.DEV_pipeline_c.fact_fund_summary\nwhere fund_summary_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.619412Z", "completed_at": "2026-01-29T20:19:49.625042Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.629394Z", "completed_at": "2026-01-29T20:19:49.629400Z"}], "thread_id": "Thread-2", "execution_time": 0.015949010848999023, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_fund_summary_fund_summary_key.c5afd7d830", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    fund_summary_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.fact_fund_summary\nwhere fund_summary_key is not null\ngroup by fund_summary_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.625333Z", "completed_at": "2026-01-29T20:19:49.636363Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.637386Z", "completed_at": "2026-01-29T20:19:49.637393Z"}], "thread_id": "Thread-1", "execution_time": 0.014660120010375977, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.report_ic_dashboard", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: report_ic_dashboard\n-- Description: Investment Committee dashboard report\n--\n\nwith portfolio_performance as (\n    select * from DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance\n),\n\nfund_summary as (\n    select * from DBT_DEMO.DEV_pipeline_c.fact_fund_summary\n),\n\nposition_snapshot as (\n    select * from DBT_DEMO.DEV_pipeline_c.fact_position_snapshot\n),\n\nlatest_portfolio_perf as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (\n                partition by portfolio_id\n                order by valuation_date desc\n            ) as rn\n        from portfolio_performance\n    )\n    where rn = 1\n),\n\nlatest_positions as (\n    select *\n    from (\n        select\n            *,\n            row_number() over (\n                partition by portfolio_id, security_id\n                order by position_date desc\n            ) as rn\n        from position_snapshot\n    )\n    where rn = 1\n),\n\nposition_summary as (\n    select\n        portfolio_id,\n        count(distinct security_id) as total_positions,\n        count(distinct sector) as sector_count,\n        sum(market_value_usd) as total_market_value,\n        max(weight_pct) as max_position_weight,\n        -- Concentration metrics\n        sum(case when weight_pct >= 0.05 then 1 else 0 end) as positions_over_5pct\n    from latest_positions\n    group by 1\n),\n\nsector_concentration as (\n    select\n        portfolio_id,\n        listagg(sector, ', ') within group (order by sector_weight desc) as top_sectors\n    from (\n        select\n            portfolio_id,\n            sector,\n            sum(weight_pct) as sector_weight,\n            row_number() over (partition by portfolio_id order by sum(weight_pct) desc) as sector_rank\n        from latest_positions\n        group by 1, 2\n    )\n    where sector_rank <= 3\n    group by 1\n),\n\ndashboard_data as (\n    select\n        lpp.portfolio_id,\n        lpp.portfolio_name,\n        lpp.portfolio_type,\n        lpp.fund_id,\n        fs.fund_name,\n        lpp.valuation_date as as_of_date,\n        lpp.nav_usd,\n        -- Performance\n        lpp.portfolio_return_1m,\n        lpp.portfolio_return_3m,\n        lpp.portfolio_return_1y,\n        lpp.portfolio_cumulative_return as inception_return,\n        -- Benchmark comparison\n        lpp.benchmark_id,\n        lpp.excess_return_1m,\n        lpp.excess_return_1y,\n        lpp.information_ratio,\n        -- Risk\n        lpp.portfolio_volatility,\n        lpp.sharpe_ratio,\n        lpp.sortino_ratio,\n        lpp.max_drawdown,\n        lpp.var_95_1d,\n        -- Positions\n        ps.total_positions,\n        ps.sector_count,\n        ps.max_position_weight,\n        ps.positions_over_5pct,\n        sc.top_sectors,\n        -- Fund level\n        fs.total_nav_usd as fund_total_nav,\n        fs.portfolio_count as fund_portfolio_count,\n        fs.weighted_sharpe_ratio as fund_sharpe,\n        -- Portfolio share of fund\n        case\n            when fs.total_nav_usd > 0\n            then lpp.nav_usd / fs.total_nav_usd * 100\n            else null\n        end as pct_of_fund\n    from latest_portfolio_perf lpp\n    left join fund_summary fs\n        on lpp.fund_id = fs.fund_id\n        and lpp.valuation_date = fs.valuation_date\n    left join position_summary ps\n        on lpp.portfolio_id = ps.portfolio_id\n    left join sector_concentration sc\n        on lpp.portfolio_id = sc.portfolio_id\n),\n\nfinal as (\n    select\n        *,\n        -- Performance score (simplified)\n        (coalesce(portfolio_return_1y, 0) * 0.4 +\n         coalesce(sharpe_ratio, 0) * 0.3 +\n         coalesce(information_ratio, 0) * 0.3) as composite_score,\n        rank() over (order by portfolio_return_1y desc nulls last) as return_rank,\n        rank() over (order by sharpe_ratio desc nulls last) as sharpe_rank\n    from dashboard_data\n)\n\nselect * from final\norder by composite_score desc", "relation_name": "DBT_DEMO.DEV_pipeline_c.report_ic_dashboard", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.629973Z", "completed_at": "2026-01-29T20:19:49.641483Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.642600Z", "completed_at": "2026-01-29T20:19:49.642609Z"}], "thread_id": "Thread-4", "execution_time": 0.01849198341369629, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.bain_capital_portfolio_analytics.report_lp_quarterly", "compiled": true, "compiled_code": "-- Pipeline C: Complex Portfolio Analytics\n-- Model: report_lp_quarterly\n-- Description: Quarterly LP reporting with period comparisons\n--\n\nwith portfolio_performance as (\n    select * from DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance\n),\n\ncashflow_summary as (\n    select * from DBT_DEMO.DEV_pipeline_a.fact_cashflow_summary\n),\n\nquarter_end_perf as (\n    select *\n    from portfolio_performance\n    where valuation_date = last_day(valuation_date, 'quarter')\n),\n\nquarterly_cashflows as (\n    select\n        portfolio_id,\n        date_trunc('quarter', cashflow_month) as quarter_start,\n        sum(case when cashflow_type = 'CONTRIBUTION' then total_amount else 0 end) as quarterly_contributions,\n        sum(case when cashflow_type = 'DISTRIBUTION' then total_amount else 0 end) as quarterly_distributions,\n        sum(case when cashflow_type = 'DIVIDEND' then total_amount else 0 end) as quarterly_dividends,\n        sum(case when cashflow_type = 'FEE' then abs(total_amount) else 0 end) as quarterly_fees,\n        sum(total_amount) as quarterly_net_cashflow,\n        count(distinct transaction_count) as total_transactions\n    from cashflow_summary\n    group by 1, 2\n),\n\ncombined as (\n    select\n        qep.portfolio_id,\n        qep.portfolio_name,\n        qep.portfolio_type,\n        qep.fund_id,\n        qep.valuation_date as quarter_end,\n        qep.valuation_quarter_start as quarter_start,\n        qep.valuation_year,\n        qep.valuation_quarter,\n        qep.nav_usd,\n        qep.portfolio_return_3m as quarterly_return,\n        qep.portfolio_return_1y,\n        qep.portfolio_cumulative_return,\n        qep.benchmark_return_3m as benchmark_quarterly_return,\n        qep.excess_return_3m as quarterly_excess_return,\n        qep.sharpe_ratio,\n        qep.sortino_ratio,\n        qep.max_drawdown,\n        qep.performance_rating,\n        qep.risk_adjusted_rating,\n        qcf.quarterly_contributions,\n        qcf.quarterly_distributions,\n        qcf.quarterly_dividends,\n        qcf.quarterly_fees,\n        qcf.quarterly_net_cashflow,\n        qcf.total_transactions\n    from quarter_end_perf qep\n    left join quarterly_cashflows qcf\n        on qep.portfolio_id = qcf.portfolio_id\n        and qep.valuation_quarter_start = qcf.quarter_start\n),\n\nwith_self_joins as (\n    select\n        c.*,\n        c_q1.nav_usd as prior_1q_nav,\n        c_q1.quarterly_return as prior_1q_return,\n        c_q1.sharpe_ratio as prior_1q_sharpe,\n        c_q2.nav_usd as prior_2q_nav,\n        c_q2.quarterly_return as prior_2q_return,\n        c_q3.nav_usd as prior_3q_nav,\n        c_q3.quarterly_return as prior_3q_return,\n        c_q4.nav_usd as prior_4q_nav,\n        c_q4.quarterly_return as prior_4q_return,\n        c_q4.sharpe_ratio as prior_4q_sharpe,\n        c_q8.nav_usd as prior_8q_nav,\n        c_q8.quarterly_return as prior_8q_return\n    from combined c\n    left join combined c_q1\n        on c.portfolio_id = c_q1.portfolio_id\n        and c_q1.quarter_end = dateadd(quarter, -1, c.quarter_end)\n    left join combined c_q2\n        on c.portfolio_id = c_q2.portfolio_id\n        and c_q2.quarter_end = dateadd(quarter, -2, c.quarter_end)\n    left join combined c_q3\n        on c.portfolio_id = c_q3.portfolio_id\n        and c_q3.quarter_end = dateadd(quarter, -3, c.quarter_end)\n    left join combined c_q4\n        on c.portfolio_id = c_q4.portfolio_id\n        and c_q4.quarter_end = dateadd(quarter, -4, c.quarter_end)\n    left join combined c_q8\n        on c.portfolio_id = c_q8.portfolio_id\n        and c_q8.quarter_end = dateadd(quarter, -8, c.quarter_end)\n),\n\nwith_window_calcs as (\n    select\n        wsj.*,\n        sum(quarterly_contributions) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between unbounded preceding and current row\n        ) as cumulative_contributions,\n        sum(quarterly_distributions) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between unbounded preceding and current row\n        ) as cumulative_distributions,\n        sum(quarterly_dividends) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between unbounded preceding and current row\n        ) as cumulative_dividends,\n        sum(quarterly_fees) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between unbounded preceding and current row\n        ) as cumulative_fees,\n        avg(quarterly_return) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between 3 preceding and current row\n        ) as rolling_4q_avg_return,\n        avg(quarterly_return) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between 7 preceding and current row\n        ) as rolling_8q_avg_return,\n        stddev(quarterly_return) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between 3 preceding and current row\n        ) as rolling_4q_volatility,\n        min(quarterly_return) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between 3 preceding and current row\n        ) as rolling_4q_min_return,\n        max(quarterly_return) over (\n            partition by wsj.portfolio_id\n            order by wsj.quarter_end\n            rows between 3 preceding and current row\n        ) as rolling_4q_max_return,\n        row_number() over (\n            partition by wsj.portfolio_id\n            order by wsj.quarterly_return desc\n        ) as best_quarter_rank,\n        row_number() over (\n            partition by wsj.portfolio_id\n            order by wsj.quarterly_return asc\n        ) as worst_quarter_rank\n    from with_self_joins wsj\n),\n\nfund_quarterly_aggs as (\n    select\n        fund_id,\n        valuation_date as quarter_end,\n        sum(nav_usd) as fund_total_nav,\n        avg(portfolio_return_3m) as fund_avg_quarterly_return,\n        count(distinct portfolio_id) as fund_portfolio_count\n    from quarter_end_perf\n    group by 1, 2\n),\n\nwith_fund_context as (\n    select\n        wwc.*,\n        fqa.fund_total_nav,\n        fqa.fund_avg_quarterly_return,\n        fqa.fund_portfolio_count\n    from with_window_calcs wwc\n    left join fund_quarterly_aggs fqa\n        on wwc.fund_id = fqa.fund_id\n        and wwc.quarter_end = fqa.quarter_end\n),\n\nwith_derived_metrics as (\n    select\n        wfc.*,\n        case\n            when wfc.fund_total_nav > 0\n            then (wfc.nav_usd / wfc.fund_total_nav) * 100\n            else null\n        end as portfolio_weight_in_fund,\n        case\n            when wfc.prior_1q_nav is not null and wfc.prior_1q_nav > 0\n            then ((wfc.nav_usd - wfc.prior_1q_nav) / wfc.prior_1q_nav) * 100\n            else null\n        end as qoq_nav_growth_pct,\n        case\n            when wfc.prior_1q_return is not null\n            then (wfc.quarterly_return - wfc.prior_1q_return)\n            else null\n        end as qoq_return_change,\n        case\n            when wfc.prior_4q_nav is not null and wfc.prior_4q_nav > 0\n            then ((wfc.nav_usd - wfc.prior_4q_nav) / wfc.prior_4q_nav) * 100\n            else null\n        end as yoy_nav_growth_pct,\n        case\n            when wfc.prior_4q_return is not null\n            then (wfc.quarterly_return - wfc.prior_4q_return)\n            else null\n        end as yoy_return_change,\n        case\n            when wfc.prior_8q_nav is not null and wfc.prior_8q_nav > 0\n            then ((wfc.nav_usd - wfc.prior_8q_nav) / wfc.prior_8q_nav) * 100\n            else null\n        end as two_year_nav_growth_pct,\n        case\n            when wfc.cumulative_contributions > 0\n            then (wfc.nav_usd + wfc.cumulative_distributions) / wfc.cumulative_contributions\n            else null\n        end as tvpi,\n        case\n            when wfc.cumulative_contributions > 0\n            then wfc.cumulative_distributions / wfc.cumulative_contributions\n            else null\n        end as dpi,\n        case\n            when wfc.cumulative_contributions > 0\n            then wfc.nav_usd / wfc.cumulative_contributions\n            else null\n        end as rvpi,\n        case\n            when wfc.rolling_4q_avg_return > wfc.rolling_8q_avg_return * 1.2 then 'ACCELERATING'\n            when wfc.rolling_4q_avg_return > wfc.rolling_8q_avg_return * 1.05 then 'IMPROVING'\n            when wfc.rolling_4q_avg_return < wfc.rolling_8q_avg_return * 0.8 then 'DECELERATING'\n            when wfc.rolling_4q_avg_return < wfc.rolling_8q_avg_return * 0.95 then 'DECLINING'\n            else 'STABLE'\n        end as performance_trend,\n        case\n            when wfc.rolling_4q_volatility < 0.02 then 'VERY_CONSISTENT'\n            when wfc.rolling_4q_volatility < 0.05 then 'CONSISTENT'\n            when wfc.rolling_4q_volatility < 0.10 then 'MODERATE'\n            when wfc.rolling_4q_volatility < 0.15 then 'VARIABLE'\n            else 'HIGHLY_VARIABLE'\n        end as consistency_rating,\n        case\n            when wfc.quarterly_return > wfc.fund_avg_quarterly_return + 0.05 then 'SIGNIFICANT_OUTPERFORM'\n            when wfc.quarterly_return > wfc.fund_avg_quarterly_return + 0.02 then 'OUTPERFORM'\n            when wfc.quarterly_return < wfc.fund_avg_quarterly_return - 0.05 then 'SIGNIFICANT_UNDERPERFORM'\n            when wfc.quarterly_return < wfc.fund_avg_quarterly_return - 0.02 then 'UNDERPERFORM'\n            else 'IN_LINE'\n        end as relative_to_fund\n    from with_fund_context wfc\n),\n\nfinal as (\n    select\n        wdm.portfolio_id,\n        wdm.portfolio_name,\n        wdm.portfolio_type,\n        wdm.fund_id,\n        wdm.quarter_end,\n        wdm.quarter_start,\n        wdm.valuation_year,\n        wdm.valuation_quarter,\n        concat('Q', wdm.valuation_quarter, ' ', wdm.valuation_year) as quarter_label,\n        concat(wdm.valuation_year, '-Q', wdm.valuation_quarter) as quarter_code,\n        concat(wdm.portfolio_name, ' (', wdm.portfolio_type, ')') as portfolio_display,\n        -- Core metrics\n        wdm.nav_usd,\n        wdm.quarterly_return,\n        wdm.benchmark_quarterly_return,\n        wdm.quarterly_excess_return,\n        wdm.portfolio_return_1y as trailing_1y_return,\n        wdm.portfolio_cumulative_return as since_inception_return,\n        wdm.sharpe_ratio,\n        wdm.sortino_ratio,\n        wdm.max_drawdown,\n        wdm.performance_rating,\n        wdm.risk_adjusted_rating,\n        -- Cashflow metrics\n        wdm.quarterly_contributions,\n        wdm.quarterly_distributions,\n        wdm.quarterly_dividends,\n        wdm.quarterly_fees,\n        wdm.quarterly_net_cashflow,\n        wdm.cumulative_contributions,\n        wdm.cumulative_distributions,\n        wdm.total_transactions,\n        -- Period comparisons\n        wdm.qoq_nav_growth_pct,\n        wdm.qoq_return_change,\n        wdm.yoy_nav_growth_pct,\n        wdm.yoy_return_change,\n        wdm.two_year_nav_growth_pct,\n        -- Performance ratios\n        wdm.tvpi,\n        wdm.dpi,\n        wdm.rvpi,\n        -- Rolling metrics\n        wdm.rolling_4q_avg_return,\n        wdm.rolling_8q_avg_return,\n        wdm.rolling_4q_volatility,\n        wdm.rolling_4q_min_return,\n        wdm.rolling_4q_max_return,\n        -- Fund context\n        wdm.fund_total_nav,\n        wdm.fund_avg_quarterly_return,\n        wdm.fund_portfolio_count,\n        wdm.portfolio_weight_in_fund,\n        -- Classifications\n        wdm.performance_trend,\n        wdm.consistency_rating,\n        wdm.relative_to_fund,\n        wdm.best_quarter_rank,\n        wdm.worst_quarter_rank,\n        case\n            when wdm.cumulative_contributions > 0\n            then wdm.cumulative_distributions / wdm.cumulative_contributions * 100\n            else null\n        end as distribution_yield_pct,\n        case\n            when wdm.cumulative_contributions > 0\n            then wdm.cumulative_fees / wdm.cumulative_contributions * 100\n            else null\n        end as fee_burden_pct\n    from with_derived_metrics wdm\n)\n\nselect * from final\norder by portfolio_id, quarter_end", "relation_name": "DBT_DEMO.DEV_pipeline_c.report_lp_quarterly", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.637899Z", "completed_at": "2026-01-29T20:19:49.647420Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.648644Z", "completed_at": "2026-01-29T20:19:49.648652Z"}], "thread_id": "Thread-3", "execution_time": 0.013113975524902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_portfolio_performance_performance_key.90bb06ab6e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect performance_key\nfrom DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance\nwhere performance_key is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.643133Z", "completed_at": "2026-01-29T20:19:49.652876Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.653875Z", "completed_at": "2026-01-29T20:19:49.653881Z"}], "thread_id": "Thread-2", "execution_time": 0.016932010650634766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_portfolio_performance_portfolio_id.d2f666a1d8", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.649180Z", "completed_at": "2026-01-29T20:19:49.658160Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.659188Z", "completed_at": "2026-01-29T20:19:49.659194Z"}], "thread_id": "Thread-1", "execution_time": 0.01258707046508789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_fact_portfolio_performance_valuation_date.b2b991e5c0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect valuation_date\nfrom DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance\nwhere valuation_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.654385Z", "completed_at": "2026-01-29T20:19:49.660062Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.665754Z", "completed_at": "2026-01-29T20:19:49.665761Z"}], "thread_id": "Thread-4", "execution_time": 0.017556190490722656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_fact_portfolio_performance_performance_key.4f87841ab7", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    performance_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.fact_portfolio_performance\nwhere performance_key is not null\ngroup by performance_key\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.660353Z", "completed_at": "2026-01-29T20:19:49.670712Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.674791Z", "completed_at": "2026-01-29T20:19:49.674798Z"}], "thread_id": "Thread-3", "execution_time": 0.017043352127075195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_report_trading_performance_portfolio_id.db6052259b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_b.report_trading_performance\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.666653Z", "completed_at": "2026-01-29T20:19:49.675285Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.676276Z", "completed_at": "2026-01-29T20:19:49.676282Z"}], "thread_id": "Thread-2", "execution_time": 0.01662421226501465, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_report_ic_dashboard_portfolio_id.b395d6ae59", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_c.report_ic_dashboard\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.671407Z", "completed_at": "2026-01-29T20:19:49.680182Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.680910Z", "completed_at": "2026-01-29T20:19:49.680916Z"}], "thread_id": "Thread-1", "execution_time": 0.014672994613647461, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.unique_report_ic_dashboard_portfolio_id.64d3f41653", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    portfolio_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_DEMO.DEV_pipeline_c.report_ic_dashboard\nwhere portfolio_id is not null\ngroup by portfolio_id\nhaving count(*) > 1\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.676782Z", "completed_at": "2026-01-29T20:19:49.685306Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.685640Z", "completed_at": "2026-01-29T20:19:49.685647Z"}], "thread_id": "Thread-4", "execution_time": 0.014650821685791016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_report_lp_quarterly_portfolio_id.7475ad6264", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect portfolio_id\nfrom DBT_DEMO.DEV_pipeline_c.report_lp_quarterly\nwhere portfolio_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T20:19:49.681838Z", "completed_at": "2026-01-29T20:19:49.686234Z"}, {"name": "execute", "started_at": "2026-01-29T20:19:49.686532Z", "completed_at": "2026-01-29T20:19:49.686538Z"}], "thread_id": "Thread-3", "execution_time": 0.006143093109130859, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.bain_capital_portfolio_analytics.not_null_report_lp_quarterly_quarter_end.826483609b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect quarter_end\nfrom DBT_DEMO.DEV_pipeline_c.report_lp_quarterly\nwhere quarter_end is null\n\n\n", "relation_name": null, "batch_results": null}], "elapsed_time": 7.500881195068359, "args": {"populate_cache": true, "require_nested_cumulative_type_params": false, "source_freshness_run_project_hooks": true, "log_level_file": "debug", "partial_parse": true, "require_yaml_configuration_for_mf_time_spines": false, "strict_mode": false, "exclude": [], "which": "compile", "upload_to_artifacts_ingest_api": false, "log_file_max_bytes": 10485760, "skip_nodes_if_on_run_start_fails": false, "static_parser": true, "printer_width": 80, "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors": true, "use_colors_file": true, "show_resource_report": false, "log_format": "default", "state_modified_compare_more_unrendered_values": false, "quiet": false, "send_anonymous_usage_stats": true, "macro_debugging": false, "project_dir": "/Users/nedazarei/Documents/turintech/dbtproject", "require_batched_execution_for_custom_microbatch_strategy": false, "require_resource_names_without_spaces": true, "cache_selected_only": false, "favor_state": false, "validate_macro_args": false, "partial_parse_file_diff": true, "state_modified_compare_vars": false, "inject_ephemeral_ctes": true, "profiles_dir": "/Users/nedazarei/Documents/turintech/dbtproject", "print": true, "log_level": "info", "empty": false, "log_format_file": "debug", "require_generic_test_arguments_property": true, "use_fast_test_edges": false, "introspect": true, "log_path": "/Users/nedazarei/Documents/turintech/dbtproject/logs", "select": [], "defer": false, "require_all_warnings_handled_by_warn_error": false, "show_all_deprecations": false, "version_check": true, "warn_error_options": {"error": [], "warn": [], "silence": []}, "invocation_command": "dbt compile", "write_json": true, "output": "text", "indirect_selection": "eager", "vars": {}}}